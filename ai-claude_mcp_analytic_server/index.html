
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="A professional blog showcasing business problem solutions.">
      
      
      
        <link rel="canonical" href="https://munishsethi.com/ai-claude_mcp_analytic_server/">
      
      
        <link rel="prev" href="..">
      
      
        <link rel="next" href="../azure-ad-certificate/">
      
      
      <link rel="icon" href="../None">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.20">
    
    
      
        <title>Data Analysis with Claude Desktop and a Custom MCP Server - Munish(s) Blog</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.e53b48f4.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/custom.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#secure-on-premises-data-analysis-with-claude-desktop-and-a-custom-mcp-server" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Munish(s) Blog" class="md-header__button md-logo" aria-label="Munish(s) Blog" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Munish(s) Blog
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Data Analysis with Claude Desktop and a Custom MCP Server
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Munish(s) Blog" class="md-nav__button md-logo" aria-label="Munish(s) Blog" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Munish(s) Blog
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    AI
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            AI
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Data Analysis with Claude Desktop and a Custom MCP Server
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Data Analysis with Claude Desktop and a Custom MCP Server
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    <span class="md-ellipsis">
      Introduction
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#full-code-srcanalystpy-with-customizations" class="md-nav__link">
    <span class="md-ellipsis">
      Full Code: src/analyst.py (with Customizations)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#code-walkthrough" class="md-nav__link">
    <span class="md-ellipsis">
      Code Walkthrough
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Code Walkthrough">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-file-listing-get_files_list" class="md-nav__link">
    <span class="md-ellipsis">
      1. File Listing (get_files_list)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-data-catalog-get_data_catalog" class="md-nav__link">
    <span class="md-ellipsis">
      2. Data Catalog (get_data_catalog)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-schema-discovery-get_schema" class="md-nav__link">
    <span class="md-ellipsis">
      3. Schema Discovery (get_schema)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-data-reading-sap-exception" class="md-nav__link">
    <span class="md-ellipsis">
      4. Data Reading (SAP Exception)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-sql-query-execution-execute_polars_sql" class="md-nav__link">
    <span class="md-ellipsis">
      5. SQL Query Execution (execute_polars_sql)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data-catalog-example-datadata_catalogjson" class="md-nav__link">
    <span class="md-ellipsis">
      Data Catalog Example (data/data_catalog.json)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#security-and-privacy" class="md-nav__link">
    <span class="md-ellipsis">
      Security and Privacy
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deployment-and-usage-packaging-as-a-windows-executable" class="md-nav__link">
    <span class="md-ellipsis">
      Deployment and Usage: Packaging as a Windows Executable
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lessons-learned-and-best-practices" class="md-nav__link">
    <span class="md-ellipsis">
      Lessons Learned and Best Practices
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conclusion" class="md-nav__link">
    <span class="md-ellipsis">
      Conclusion
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#references-and-credits" class="md-nav__link">
    <span class="md-ellipsis">
      References and Credits
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Azure
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Azure
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../azure-ad-certificate/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Certificate Based Authentication
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../azure-billing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Download Azure Bill
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../azure-resources/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Download Azure Resource
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../azure-query-recovery-services-vault/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Query Recovery Services Vault
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../azure-ad-user/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Entra Users, User Groups and Licence assignments
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../azure-ad-user-devices/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Entra User Devices
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../azure-container-schedule/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Orchestrating Scheduled Jobs (Container Instances)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../devops-build-container/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    DevOps Build Container
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../devops-deploy-container-iac/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    DevOps Deploy Container IaC
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../devops-deploy-container-github-action/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    DevOps Deploy Container Github Actions
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../avd-custon-image-compute-gallery-part1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Building and Publishing an Custom Image
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../avd-publish-part2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Deploying Azure Virtual Desktop (AVD) Desktops
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../avd-cleanup-obsolete-fsLogix-profiles/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Cleanup Obsolete FXLogix Profiles(AVD)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../azure-bcpdr-part1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Business Coninuity Program / Diasister Recovery - Part 1
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../azure-bcpdr-part2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Business Continuity Program / Disaster Recovery - Part 2
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../azure-bcpdr-github-action/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Business Continuity Program / Disaster Recovery - Git Hub Action
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../azure-restore-from-backup-part1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Restore VM from RSV Backup - Part 1
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../azure-restore-from-backup-part2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Restore VM from RSV Backup - Part 2
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Fabric
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Fabric
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../fabric-wharehouse-fact-import/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Warehouse data import
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Cisco Meraki, Nagios XI & Manage Engine
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Cisco Meraki, Nagios XI & Manage Engine
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../meraki-unused-device-sync/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Cisco Meraki Unused Devices
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../meraki-nagios-device-sync/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Cisco Meraki Devices Discovery and Nagios Integration
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../monitoring-itsm-integration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Integrating Monitoring System with ITSM System
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../meraki-vm-deployment/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Deploying Cisco Meraki vMX
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Active Directory Domain Services
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Active Directory Domain Services
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../adds-user-creation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Create ADDS User
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../adds-user-update/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Update ADDS User
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    SAP
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            SAP
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../sap-rfc-python-container/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Setup PyRFC in your Container
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../sap-rfc-python/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Calling SAP RFC Function Modules from Python
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../sap-system-start-stop/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Automating SAP System Start/Stop Operations
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    O365
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            O365
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../adaptive-card-consultant-review-part1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Outlook Actionable Adaptive Card - Part 1
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../adaptive-card-consultant-review-part2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Outlook Actionable Adaptive Card - Part 2
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../sharepoint-sites-enumeration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Sharepoint Sites Enumeration
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../sharepoint-site-library-enumeration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Sharepoint Document Library Enumeration
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../sharepoint-site-library-to-azure-fileshare/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Migrate Sharepoint Document Library to Azure File Share
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../sap-concur-expense-reports-aggregation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Concur Expense Report Aggregation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../teams-user-number-assignment/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Get all Teams Phone Assignment(s)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../deprovision-user/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Deprovison User
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tenantallowblocklist/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tenant Allow Block List - False Positive
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../email-o365-proofpoint-part1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    O365 and Proof Point Essentials - Part 1
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../email-o365-proofpoint-part2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    O365 and Proof Point Essentials - Part 2
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../email-o365-proofpoint-part3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    O365 and Proof Point Essentials - Part 3
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../email-o365-proofpoint-part4/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    O365 and Proof Point Essentials - Part 4
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../email-o365-proofpoint-part5/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    O365 and Proof Point Essentials - Part 5
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../spo-o365_excel_automation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    O365/Excel Automation via SPO
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9" >
        
          
          <label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    UKG
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9">
            <span class="md-nav__icon md-icon"></span>
            UKG
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ukg-sftp-file-transfer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Secure File Transfer with UKG Dimensions
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ukg-api-employee-verification/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Employee Verification via API
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ukg-api-integration-and-dataview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Automating Integration Execution and Dataview extract
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10" >
        
          
          <label class="md-nav__link" for="__nav_10" id="__nav_10_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Misc
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10">
            <span class="md-nav__icon md-icon"></span>
            Misc
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../proofpoint-user-management/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Proof Point User Management
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../github-clean-deployments/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Clean GitHub Deployments
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../proofpointo365connector/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Understanding DMARC/Spoofing, O365 with ProofPoint
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    <span class="md-ellipsis">
      Introduction
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#full-code-srcanalystpy-with-customizations" class="md-nav__link">
    <span class="md-ellipsis">
      Full Code: src/analyst.py (with Customizations)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#code-walkthrough" class="md-nav__link">
    <span class="md-ellipsis">
      Code Walkthrough
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Code Walkthrough">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-file-listing-get_files_list" class="md-nav__link">
    <span class="md-ellipsis">
      1. File Listing (get_files_list)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-data-catalog-get_data_catalog" class="md-nav__link">
    <span class="md-ellipsis">
      2. Data Catalog (get_data_catalog)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-schema-discovery-get_schema" class="md-nav__link">
    <span class="md-ellipsis">
      3. Schema Discovery (get_schema)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-data-reading-sap-exception" class="md-nav__link">
    <span class="md-ellipsis">
      4. Data Reading (SAP Exception)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-sql-query-execution-execute_polars_sql" class="md-nav__link">
    <span class="md-ellipsis">
      5. SQL Query Execution (execute_polars_sql)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data-catalog-example-datadata_catalogjson" class="md-nav__link">
    <span class="md-ellipsis">
      Data Catalog Example (data/data_catalog.json)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#security-and-privacy" class="md-nav__link">
    <span class="md-ellipsis">
      Security and Privacy
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deployment-and-usage-packaging-as-a-windows-executable" class="md-nav__link">
    <span class="md-ellipsis">
      Deployment and Usage: Packaging as a Windows Executable
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lessons-learned-and-best-practices" class="md-nav__link">
    <span class="md-ellipsis">
      Lessons Learned and Best Practices
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conclusion" class="md-nav__link">
    <span class="md-ellipsis">
      Conclusion
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#references-and-credits" class="md-nav__link">
    <span class="md-ellipsis">
      References and Credits
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="secure-on-premises-data-analysis-with-claude-desktop-and-a-custom-mcp-server">Secure, On-Premises Data Analysis with Claude Desktop and a Custom MCP Server</h1>
<p><em>Inspired by and adapted from <a href="https://github.com/unravel-team/mcp-analyst">mcp-analyst</a>. This guide documents a customized, production-ready approach for secure, LLM-powered analytics on enterprise CSV/Parquet data, including new tools and deployment strategies for real-world business needs.</em></p>
<h2 id="introduction">Introduction</h2>
<p>Many organizations accumulate large numbers of CSV and Parquet files—sometimes related, sometimes not. These files are often daily or periodic extracts from a variety of systems, created for business leaders (like the CIO) who need insights but lack the time or tools to analyze them manually. For example, you might have daily extracts of:</p>
<ul>
<li>Office 365 license assignments</li>
<li>OneDrive storage usage</li>
<li>Account properties (e.g., password last set, last login)</li>
<li>Device inventories from Entra ID</li>
<li>HR or SAP exports</li>
<li>And much more</li>
</ul>
<p>While these files can be loaded into Excel for pivots or imported into a database, this process is time-consuming and often impractical for busy executives. This solution enables natural language queries directly on your CSV/Parquet files—no manual analysis or report building required.</p>
<p><strong>This guide shows how to empower business users to analyze all their data, securely, using a local MCP (Model Context Protocol) server and Claude Desktop.</strong></p>
<hr />
<h2 id="full-code-srcanalystpy-with-customizations">Full Code: <code>src/analyst.py</code> (with Customizations)</h2>
<p>The following code is based on <a href="https://github.com/unravel-team/mcp-analyst">mcp-analyst</a> but has been extended for real-world enterprise use. Notably, it adds the <code>get_data_catalog</code> tool for rich business context, SAP CSV delimiter handling, and is designed for packaging as a Windows executable.</p>
<p>Below is the complete, up-to-date code for the MCP server. This code exposes tools for file listing, schema discovery, business context, and SQL query execution. It uses the high-performance Polars library for data processing and is ready for packaging as a Windows executable for easy deployment.</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">argparse</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Optional</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic</span><span class="w"> </span><span class="kn">import</span> <span class="n">Field</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">mcp.server.fastmcp</span><span class="w"> </span><span class="kn">import</span> <span class="n">FastMCP</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">glob</span><span class="w"> </span><span class="kn">import</span> <span class="n">glob</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">polars</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pl</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>

<span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">()</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--file_location&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;data/*.csv&quot;</span><span class="p">)</span>
<span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>

<span class="n">mcp</span> <span class="o">=</span> <span class="n">FastMCP</span><span class="p">(</span><span class="s2">&quot;analyst&quot;</span><span class="p">,</span> <span class="n">dependencies</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;polars&quot;</span><span class="p">])</span>

<span class="nd">@mcp</span><span class="o">.</span><span class="n">tool</span><span class="p">()</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_files_list</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get the list of files that are source of data</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">files_list</span> <span class="o">=</span> <span class="n">glob</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">file_location</span><span class="p">)</span>
    <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">files_list</span><span class="p">)</span>

<span class="nd">@mcp</span><span class="o">.</span><span class="n">tool</span><span class="p">()</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_data_catalog</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get the data catalog with descriptions of all available datasets.</span>

<span class="sd">    Use this tool to understand:</span>
<span class="sd">    - What each CSV file contains and its business purpose</span>
<span class="sd">    - Column meanings, data types, and business rules</span>
<span class="sd">    - Data relationships and join keys between files</span>
<span class="sd">    - Common query patterns and best practices</span>

<span class="sd">    This catalog provides business context. Always combine with get_schema() </span>
<span class="sd">    to see the actual current columns in each file.</span>

<span class="sd">    DATA CATALOG STRUCTURE:</span>
<span class="sd">    The data_catalog.json file follows this schema:</span>

<span class="sd">    {</span>
<span class="sd">      &quot;version&quot;: &quot;X.X&quot;,                    // Catalog version number</span>
<span class="sd">      &quot;last_updated&quot;: &quot;YYYY-MM-DD&quot;,        // Last modification date</span>
<span class="sd">      &quot;datasets&quot;: {</span>
<span class="sd">        &quot;dataset_key&quot;: {                   // Lowercase key (not filename)</span>
<span class="sd">          &quot;filename&quot;: &quot;Actual_File.csv&quot;,   // Real filename (case-sensitive)</span>
<span class="sd">          &quot;category&quot;: &quot;Category_Name&quot;,     // From categories section</span>
<span class="sd">          &quot;description&quot;: &quot;...&quot;,            // Business purpose</span>
<span class="sd">          &quot;source_system&quot;: &quot;...&quot;,          // Origin system(s)</span>
<span class="sd">          &quot;delimiter&quot;: &quot;,&quot; or &quot;;&quot;,         // CSV delimiter</span>
<span class="sd">          &quot;update_frequency&quot;: &quot;...&quot;,       // Optional: refresh schedule</span>

<span class="sd">          &quot;columns&quot;: {                     // Column documentation</span>
<span class="sd">            &quot;_note&quot;: &quot;...&quot;,                // ALWAYS start with _note explaining schema approach</span>

<span class="sd">            // Then document ONLY the important/non-obvious columns:</span>
<span class="sd">            &quot;critical_column_name&quot;: {</span>
<span class="sd">              &quot;description&quot;: &quot;...&quot;,        // What this column means</span>
<span class="sd">              &quot;data_type&quot;: &quot;...&quot;,          // string|integer|boolean|date</span>
<span class="sd">              &quot;required&quot;: true|false,      // Is it always populated?</span>
<span class="sd">              &quot;importance&quot;: &quot;CRITICAL&quot;,    // Mark important columns</span>
<span class="sd">              &quot;possible_values&quot;: [...],    // Optional: enum values</span>
<span class="sd">              &quot;constant_value&quot;: &quot;...&quot;,     // Optional: if always same</span>
<span class="sd">              &quot;format&quot;: &quot;...&quot;,             // Optional: date formats etc</span>
<span class="sd">              &quot;usage_note&quot;: &quot;...&quot;,         // Optional: how to use it</span>
<span class="sd">              &quot;source&quot;: &quot;...&quot;              // Optional: for prefixed columns (adds_, entra_, etc.)</span>
<span class="sd">            }</span>
<span class="sd">            // Leave out self-descriptive columns - LLM will discover via get_schema()</span>
<span class="sd">          },</span>

<span class="sd">          &quot;business_rules&quot;: [...],         // Important constraints</span>
<span class="sd">          &quot;common_queries&quot;: [...],         // Example questions</span>
<span class="sd">          &quot;device_types_included&quot;: [...],  // Optional: for inventories</span>

<span class="sd">          &quot;joins&quot;: {                       // Optional: join definitions</span>
<span class="sd">            &quot;join_name&quot;: {</span>
<span class="sd">              &quot;target_dataset&quot;: &quot;...&quot;,</span>
<span class="sd">              &quot;join_condition&quot;: &quot;...&quot;,</span>
<span class="sd">              &quot;description&quot;: &quot;...&quot;</span>
<span class="sd">            }</span>
<span class="sd">          },</span>

<span class="sd">          &quot;related_datasets&quot;: [...],       // Related file keys</span>
<span class="sd">          &quot;usage_tip&quot;: &quot;...&quot;,              // Consumption guidance</span>
<span class="sd">          &quot;comparison_note&quot;: &quot;...&quot;         // Optional: vs other files</span>
<span class="sd">        }</span>
<span class="sd">      },</span>

<span class="sd">      &quot;categories&quot;: {                      // Category definitions</span>
<span class="sd">        &quot;Category_Name&quot;: {</span>
<span class="sd">          &quot;description&quot;: &quot;...&quot;</span>
<span class="sd">        }</span>
<span class="sd">      }</span>
<span class="sd">    }</span>

<span class="sd">    IMPORTANT CONVENTIONS:</span>
<span class="sd">    - Dataset keys are lowercase with underscores (e.g., &quot;idp_hr&quot;)</span>
<span class="sd">    - Filenames preserve original casing (e.g., &quot;IDP_HR.csv&quot;)</span>
<span class="sd">    - **Columns section philosophy**: Document only important/non-obvious columns</span>
<span class="sd">      * ALWAYS start with &quot;_note&quot; explaining the schema approach</span>
<span class="sd">      * Document critical columns (joins, filters, business rules)</span>
<span class="sd">      * Skip self-descriptive columns - LLM discovers them via get_schema()</span>
<span class="sd">      * This reduces maintenance and focuses LLM attention on what matters</span>
<span class="sd">    - Always include &quot;usage_tip&quot; directing users to call get_schema()</span>
<span class="sd">    - Column prefixes (adds_, entra_, hr_) indicate source systems</span>
<span class="sd">    - &quot;importance&quot;: &quot;CRITICAL&quot; marks key columns for joins/filters</span>
<span class="sd">    - Delimiter usually &quot;,&quot; but &quot;;&quot; for SAP files (sap_* prefix)</span>

<span class="sd">    Returns comprehensive documentation for all datasets in JSON format.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Use the same directory logic as the CSV files</span>
    <span class="n">file_pattern</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">file_location</span>
    <span class="n">data_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">file_pattern</span><span class="p">)</span>
    <span class="n">catalog_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data_dir</span><span class="p">,</span> <span class="s2">&quot;data_catalog.json&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">catalog_path</span><span class="p">):</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">catalog_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">catalog</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">catalog</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span>
            <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;Data catalog not found&quot;</span><span class="p">,</span>
            <span class="s2">&quot;path_checked&quot;</span><span class="p">:</span> <span class="n">catalog_path</span><span class="p">,</span>
            <span class="s2">&quot;note&quot;</span><span class="p">:</span> <span class="s2">&quot;Ensure data_catalog.json is in the same folder as CSV files&quot;</span><span class="p">,</span>
            <span class="s2">&quot;schema_help&quot;</span><span class="p">:</span> <span class="s2">&quot;See get_data_catalog() docstring for data_catalog.json structure&quot;</span>
        <span class="p">})</span>

        <span class="k">return</span> <span class="n">pl</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">dfs</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">file_type</span> <span class="o">==</span> <span class="s2">&quot;parquet&quot;</span><span class="p">:</span>
        <span class="n">dfs</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span><span class="n">file_locations</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">dfs</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unsupported file type: </span><span class="si">{</span><span class="n">file_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="nd">@mcp</span><span class="o">.</span><span class="n">tool</span><span class="p">()</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_schema</span><span class="p">(</span>
    <span class="n">file_location</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">file_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The type of the file to be read. Supported types are csv and parquet&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="s2">&quot;csv&quot;</span><span class="p">,</span>
    <span class="p">),</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get the schema of a single data file from the given file location</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">read_file</span><span class="p">(</span><span class="n">file_location</span><span class="p">,</span> <span class="n">file_type</span><span class="p">)</span>
    <span class="n">schema</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">schema</span>
    <span class="n">schema_dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">schema</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">schema_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">schema_dict</span><span class="p">]</span>

<span class="c1"># ... (Polars SQL function lists omitted for brevity)</span>

<span class="nd">@mcp</span><span class="o">.</span><span class="n">tool</span><span class="p">()</span>
<span class="k">def</span><span class="w"> </span><span class="nf">execute_polars_sql</span><span class="p">(</span>
    <span class="n">file_locations</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">query</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The polars sql query to be executed.&quot;</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="n">file_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The type of the file to be read. Supported types are csv and parquet&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="s2">&quot;csv&quot;</span><span class="p">,</span>
    <span class="p">),</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reads the data from the given file locations. Executes the given polars sql query and returns the result.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">read_file_list</span><span class="p">(</span><span class="n">file_locations</span><span class="p">,</span> <span class="n">file_type</span><span class="p">)</span>
    <span class="n">op_df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
    <span class="n">output_records</span> <span class="o">=</span> <span class="n">op_df</span><span class="o">.</span><span class="n">to_dicts</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">output_records</span>

<span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
    <span class="n">mcp</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</code></pre></div>
<hr />
<h2 id="code-walkthrough">Code Walkthrough</h2>
<h3 id="1-file-listing-get_files_list">1. File Listing (<code>get_files_list</code>)</h3>
<p>Lists all available CSV/Parquet files for the LLM to consider. Only files in the specified directory are accessible.</p>
<hr />
<h3 id="2-data-catalog-get_data_catalog">2. Data Catalog (<code>get_data_catalog</code>)</h3>
<p><strong>This is the most important customization in this solution.</strong></p>
<ul>
<li><strong>Purpose:</strong> Supplies the LLM with business context, column definitions, relationships, and usage tips for each dataset, as defined in <code>data/data_catalog.json</code>.</li>
<li><strong>How it works:</strong><ul>
<li>The tool reads the JSON catalog and returns it as a string.</li>
<li>The catalog documents not just columns, but also business rules, join keys, and common queries.</li>
<li>This enables the LLM to:<ul>
<li>Understand which columns are critical for joins or filters</li>
<li>Know which datasets are related (e.g., HR and IDP)</li>
<li>Avoid common mistakes (e.g., duplicate records, wrong filters)</li>
<li>Provide more accurate, context-aware answers</li>
</ul>
</li>
</ul>
</li>
<li><strong>Why not just use <code>get_schema</code>?</strong><ul>
<li><code>get_schema</code> only shows column names and types. It cannot explain business meaning, relationships, or best practices.</li>
<li>The catalog is especially valuable for large, complex datasets and when onboarding new users or LLMs.</li>
</ul>
</li>
<li><strong>Security:</strong> Only metadata is exposed, not actual data.</li>
</ul>
<hr />
<h3 id="3-schema-discovery-get_schema">3. Schema Discovery (<code>get_schema</code>)</h3>
<p>Lets the LLM see the actual columns and types in each file. Handles files with millions of rows efficiently using Polars.</p>
<hr />
<h3 id="4-data-reading-sap-exception">4. Data Reading (SAP Exception)</h3>
<p>SAP systems often export CSVs with <code>;</code> instead of <code>,</code>—this logic ensures correct parsing for SAP files.</p>
<hr />
<h3 id="5-sql-query-execution-execute_polars_sql">5. SQL Query Execution (<code>execute_polars_sql</code>)</h3>
<p>Executes LLM-generated Polars SQL queries on one or more files. Handles large datasets (millions of rows) with high performance.</p>
<hr />
<h2 id="data-catalog-example-datadata_catalogjson">Data Catalog Example (<code>data/data_catalog.json</code>)</h2>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;version&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1.1&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;last_updated&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2025-10-19&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;datasets&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;idp_hr&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;filename&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;idp_hr.csv&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;category&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Identity_Management&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Master identity dataset merging ADDS, Entra ID, and HR system attributes...&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;columns&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;_note&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Most columns are self-descriptive with prefixes indicating source system (adds_, entra_, hr_, onedrive_). Critical columns documented below.&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;entra_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Entra user GUID. JOIN KEY from entra_user_devices.csv (user_id column).&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;data_type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;importance&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;CRITICAL - Primary key for joins&quot;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="nt">&quot;business_rules&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="s2">&quot;One row per person - all ADDS, Entra, and HR attributes merged&quot;</span>
<span class="w">      </span><span class="p">],</span>
<span class="w">      </span><span class="nt">&quot;common_queries&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="s2">&quot;Users in ADDS but not Entra (source_adds_entra = &#39;adds&#39;)&quot;</span>
<span class="w">      </span><span class="p">],</span>
<span class="w">      </span><span class="nt">&quot;usage_tip&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;This is the PRIMARY user lookup table. Use column prefixes to understand data source. Use get_schema() to explore all columns.&quot;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<hr />
<h2 id="security-and-privacy">Security and Privacy</h2>
<ul>
<li><strong>Data never leaves the network:</strong> All computation happens locally; only query results are sent to the user.</li>
<li><strong>No cloud LLM risk:</strong> Unlike SaaS analytics or cloud LLMs, your sensitive data is never uploaded.</li>
<li><strong>Fine-grained access:</strong> Only files in the specified directory are accessible.</li>
</ul>
<hr />
<h2 id="deployment-and-usage-packaging-as-a-windows-executable">Deployment and Usage: Packaging as a Windows Executable</h2>
<p>One of the key requirements for enterprise adoption is <strong>zero Python installation on user PCs</strong>. To achieve this:</p>
<ol>
<li><strong>Package the MCP server as a single Windows executable</strong> using PyInstaller:
        <div class="highlight"><pre><span></span><code>pyinstaller<span class="w"> </span>--onefile<span class="w"> </span>--name<span class="w"> </span>cio-mcp_server<span class="w"> </span>src<span class="se">\a</span>nalyst.py
</code></pre></div>
        - This bundles Python, all dependencies, and your code into a single <code>.exe</code> file.
        - No Python, pip, or library installs are needed on the user's machine.</li>
<li><strong>Deploy the executable and all CSV/Parquet files (plus <code>data_catalog.json</code>) on a secure server share.</strong></li>
<li><strong>Users only need Claude Desktop and access to the server share.</strong></li>
<li><strong>Configure Claude Desktop to use the MCP server executable as a local tool.</strong></li>
<li><strong>All computation and data access remain on-premises.</strong></li>
</ol>
<hr />
<h2 id="lessons-learned-and-best-practices">Lessons Learned and Best Practices</h2>
<ul>
<li><strong>LLMs can often infer schema, but the data catalog is essential for complex, cross-file queries and business logic.</strong></li>
<li><strong>Polars handled millions of rows with ease</strong>—far better than Excel or Power BI for ad hoc queries.</li>
<li><strong>SAP CSV delimiter handling is critical:</strong> Many SAP exports use <code>;</code> instead of <code>,</code>. This is handled automatically in the code.</li>
<li><strong>Even with well-defined semantic models, neither Power BI's LLM tools nor Fabric matched the flexibility and accuracy of this approach.</strong></li>
<li><strong>Business users can answer their own questions—no more waiting for IT to build new reports.</strong></li>
<li><strong>Security:</strong> No data leaves the network. Only query results are returned to the user.</li>
</ul>
<hr />
<h2 id="conclusion">Conclusion</h2>
<p>By combining a local MCP server (customized from <a href="https://github.com/unravel-team/mcp-analyst">mcp-analyst</a>), Claude Desktop, and a well-maintained data catalog, you can deliver secure, flexible, and powerful analytics on enterprise CSV/Parquet data. Business users can ask any question, across any dataset, without moving data or waiting for IT. The addition of the <code>get_data_catalog</code> tool is a game-changer for context-aware analytics, enabling the LLM to reason about business logic, relationships, and best practices.</p>
<hr />
<h2 id="references-and-credits">References and Credits</h2>
<ul>
<li><a href="https://github.com/unravel-team/mcp-analyst">mcp-analyst GitHub repository</a> — Original codebase and inspiration for this solution.</li>
<li><a href="https://pola.rs/">Polars DataFrame library</a> — High-performance data processing in Python.</li>
<li><a href="https://claude.ai/">Claude Desktop</a> — LLM client for natural language analytics.</li>
<li><a href="https://pyinstaller.org/">PyInstaller</a> — For packaging Python code as a Windows executable.</li>
</ul>
<p><em>For more details, see the full code in <code>src/analyst.py</code> and the data catalog in <code>data/data_catalog.json</code>.</em></p>







  
    
  
  


  <aside class="md-source-file">
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="Last update">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date" title="October 19, 2025 20:15:21 UTC">October 19, 2025</span>
  </span>

    
    
    
    
  </aside>





                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": ["navigation.sections", "content.code.annotate", "content.code.copy"], "search": "../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
        <script src="../assets/custom.js"></script>
      
    
  </body>
</html>