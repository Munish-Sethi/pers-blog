
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="A professional blog showcasing business problem solutions.">
      
      
      
        <link rel="canonical" href="https://Munish-Sethi.github.io/pers-blog/avd-cleanup-obsolete-fsLogix-profiles/">
      
      
        <link rel="prev" href="../avd-publish-part2/">
      
      
        <link rel="next" href="../azure-bcpdr-part1/">
      
      
      <link rel="icon" href="../None">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.14">
    
    
      
        <title>Cleanup Obsolete FXLogix Profiles(AVD) - Munish(s) Blog</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.342714a4.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/custom.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#cleaning-up-obsolete-fslogix-profiles-in-azure" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Munish(s) Blog" class="md-header__button md-logo" aria-label="Munish(s) Blog" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Munish(s) Blog
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Cleanup Obsolete FXLogix Profiles(AVD)
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Munish(s) Blog" class="md-nav__button md-logo" aria-label="Munish(s) Blog" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Munish(s) Blog
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home1
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Azure
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Azure
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../azure-ad-certificate/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Certificate Based Authentication
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../azure-billing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Download Azure Bill
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../azure-resources/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Download Azure Resource
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../azure-query-recovery-services-vault/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Query Recovery Services Vault
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../azure-ad-user/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Entra Users, User Groups and Licence assignments
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../azure-ad-user-devices/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Entra User Devices
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../azure-container-schedule/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Orchestrating Scheduled Jobs (Container Instances)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../devops-build-container/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    DevOps Build Container
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../devops-deploy-container-iac/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    DevOps Deploy Container IaC
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../devops-deploy-container-github-action/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    DevOps Deploy Container Github Actions
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../avd-custon-image-compute-gallery-part1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Building and Publishing an Custom Image
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../avd-publish-part2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Deploying Azure Virtual Desktop (AVD) Desktops
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Cleanup Obsolete FXLogix Profiles(AVD)
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Cleanup Obsolete FXLogix Profiles(AVD)
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#why-clean-up-obsolete-profiles" class="md-nav__link">
    <span class="md-ellipsis">
      Why Clean Up Obsolete Profiles?
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#multi-step-approach" class="md-nav__link">
    <span class="md-ellipsis">
      Multi-Step Approach
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#example-script-identify-obsolete-fslogix-profiles" class="md-nav__link">
    <span class="md-ellipsis">
      Example Script: Identify Obsolete FSLogix Profiles
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-by-step-explanation" class="md-nav__link">
    <span class="md-ellipsis">
      Step-by-Step Explanation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#benefits-of-running-in-a-container" class="md-nav__link">
    <span class="md-ellipsis">
      Benefits of Running in a Container
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#next-steps-deleting-obsolete-profiles" class="md-nav__link">
    <span class="md-ellipsis">
      Next Steps: Deleting Obsolete Profiles
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#usage-example" class="md-nav__link">
    <span class="md-ellipsis">
      Usage Example
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../azure-bcpdr-part1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Business Coninuity Program / Diasister Recovery - Part 1
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../azure-bcpdr-part2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Business Continuity Program / Disaster Recovery - Part 2
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../azure-bcpdr-github-action/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Business Continuity Program / Disaster Recovery - Git Hub Action
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../azure-restore-from-backup-part1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Restore VM from RSV Backup - Part 1
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../azure-restore-from-backup-part2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Restore VM from RSV Backup - Part 2
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Fabric
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Fabric
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../fabric-warehouse-fact-import.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    WarWharehouse data import
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Cisco Meraki, Nagios XI & Manage Engine
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Cisco Meraki, Nagios XI & Manage Engine
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../meraki-unused-device-sync/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Cisco Meraki Unused Devices
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../meraki-nagios-device-sync/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Cisco Meraki Devices Discovery and Nagios Integration
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../monitoring-itsm-integration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Integrating Monitoring System with ITSM System
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../meraki-vm-deployment/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Deploying Cisco Meraki vMX
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Active Directory Domain Services
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Active Directory Domain Services
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../adds-user-creation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Create ADDS User
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../adds-user-update/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Update ADDS User
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    SAP
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            SAP
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../sap-rfc-python-container/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Setup PyRFC in your Container
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../sap-rfc-python/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Calling SAP RFC Function Modules from Python
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    O365
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            O365
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../adaptive-card-consultant-review-part1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Outlook Actionable Adaptive Card - Part 1
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../adaptive-card-consultant-review-part2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Outlook Actionable Adaptive Card - Part 2
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../sharepoint-sites-enumeration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Sharepoint Sites Enumeration
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../sharepoint-site-library-enumeration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Sharepoint Document Library Enumeration
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../sharepoint-site-library-to-azure-fileshare/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Migrate Sharepoint Document Library to Azure File Share
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../sap-concur-expense-reports-aggregation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Concur Expense Report Aggregation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../teams-user-number-assignment/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Get all Teams Phone Assignment(s)
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    UKG
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            UKG
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ukg-sftp-file-transfer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Secure File Transfer with UKG Dimensions
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ukg-api-employee-verification/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Employee Verification via API
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ukg-api-integration-and-dataview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Automating Integration Execution and Dataview extract
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9" >
        
          
          <label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Misc
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9">
            <span class="md-nav__icon md-icon"></span>
            Misc
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../proofpoint-user-management/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Proof Point User Management
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../github-clean-deployments/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Clean GitHub Deployments
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#why-clean-up-obsolete-profiles" class="md-nav__link">
    <span class="md-ellipsis">
      Why Clean Up Obsolete Profiles?
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#multi-step-approach" class="md-nav__link">
    <span class="md-ellipsis">
      Multi-Step Approach
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#example-script-identify-obsolete-fslogix-profiles" class="md-nav__link">
    <span class="md-ellipsis">
      Example Script: Identify Obsolete FSLogix Profiles
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-by-step-explanation" class="md-nav__link">
    <span class="md-ellipsis">
      Step-by-Step Explanation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#benefits-of-running-in-a-container" class="md-nav__link">
    <span class="md-ellipsis">
      Benefits of Running in a Container
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#next-steps-deleting-obsolete-profiles" class="md-nav__link">
    <span class="md-ellipsis">
      Next Steps: Deleting Obsolete Profiles
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#usage-example" class="md-nav__link">
    <span class="md-ellipsis">
      Usage Example
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="cleaning-up-obsolete-fslogix-profiles-in-azure">Cleaning Up Obsolete FSLogix Profiles in Azure</h1>
<p>Obsolete FSLogix profile containers can consume significant storage and increase costs in Azure environments. This article explains how to identify and delete outdated profiles using a Bash script, helping you save space and reduce expenses. The approach is multi-step: first, list and analyze profiles, then safely delete those that are no longer needed. This process is ideal for automation and can be run in a container for portability and security.</p>
<hr />
<h2 id="why-clean-up-obsolete-profiles">Why Clean Up Obsolete Profiles?</h2>
<ul>
<li><strong>Cost Savings:</strong> Old FSLogix profile containers can accumulate and consume large amounts of Azure Files storage, leading to unnecessary costs.</li>
<li><strong>Performance:</strong> Removing unused profiles can improve performance and reduce clutter.</li>
<li><strong>Compliance:</strong> Regular cleanup helps maintain a tidy, compliant environment.</li>
</ul>
<hr />
<h2 id="multi-step-approach">Multi-Step Approach</h2>
<ol>
<li><strong>List and Analyze Profiles:</strong> Identify which profiles are old and candidates for deletion.</li>
<li><strong>Delete Obsolete Profiles:</strong> Remove only those that are confirmed to be outdated.</li>
</ol>
<p>This article covers the first stepâ€”identifying obsolete profiles. (You can extend the script to perform deletions after review.)</p>
<hr />
<h2 id="example-script-identify-obsolete-fslogix-profiles">Example Script: Identify Obsolete FSLogix Profiles</h2>
<p>Below is a Bash script that lists FSLogix profile containers in an Azure Files share, checks their last modified date, and logs those that haven't been updated in a specified number of days. All sensitive values are masked for security.</p>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>

<span class="c1"># Define the output log files</span>
<span class="nv">deleteLogFile</span><span class="o">=</span><span class="s2">&quot;step1-verbose.log&quot;</span>
<span class="nv">sizeLogFile</span><span class="o">=</span><span class="s2">&quot;step1-filesize.log&quot;</span>
<span class="nv">deleteFile</span><span class="o">=</span><span class="s2">&quot;step1-input4step2.txt&quot;</span>

<span class="c1"># Variables (replace with your own values)</span>
<span class="nv">resourceGroupName</span><span class="o">=</span><span class="s2">&quot;&lt;your-resource-group&gt;&quot;</span>
<span class="nv">storageAccountName</span><span class="o">=</span><span class="s2">&quot;&lt;your-storage-account&gt;&quot;</span>
<span class="nv">fileShareName</span><span class="o">=</span><span class="s2">&quot;&lt;your-file-share&gt;&quot;</span>
<span class="nv">daysThreshold</span><span class="o">=</span><span class="m">30</span>
<span class="nv">maxProfiles</span><span class="o">=</span><span class="m">500</span><span class="w">  </span><span class="c1"># Limit the number of profiles to process</span>

<span class="c1"># Determine the script directory</span>
<span class="nv">scriptDir</span><span class="o">=</span><span class="s2">&quot;</span><span class="k">$(</span>dirname<span class="w"> </span><span class="se">\&quot;</span><span class="k">$(</span>realpath<span class="w"> </span><span class="se">\&quot;</span><span class="nv">$0</span><span class="se">\&quot;</span><span class="k">)</span><span class="se">\&quot;</span><span class="k">)</span><span class="s2">&quot;</span>
<span class="nv">deleteFile</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$scriptDir</span><span class="s2">/</span><span class="nv">$deleteFile</span><span class="s2">&quot;</span>
<span class="nv">sizeFile</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$scriptDir</span><span class="s2">/</span><span class="nv">$sizeLogFile</span><span class="s2">&quot;</span>
<span class="nv">deleteLogFile</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$scriptDir</span><span class="s2">/</span><span class="nv">$deleteLogFile</span><span class="s2">&quot;</span>

<span class="c1"># Delete existing files if they exist</span>
<span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>-f<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$deleteFile</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Deleting existing delete file: </span><span class="nv">$deleteFile</span><span class="s2">&quot;</span>
<span class="w">    </span>rm<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$deleteFile</span><span class="s2">&quot;</span>
<span class="k">fi</span>

<span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>-f<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$deleteLogFile</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Deleting existing delete log file: </span><span class="nv">$deleteLogFile</span><span class="s2">&quot;</span>
<span class="w">    </span>rm<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$deleteLogFile</span><span class="s2">&quot;</span>
<span class="k">fi</span>

<span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>-f<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$sizeFile</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Deleting existing size log file: </span><span class="nv">$sizeFile</span><span class="s2">&quot;</span>
<span class="w">    </span>rm<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$sizeFile</span><span class="s2">&quot;</span>
<span class="k">fi</span>

<span class="c1"># Redirect all echo output to the delete log file</span>
<span class="nb">exec</span><span class="w"> </span>&gt;<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$deleteLogFile</span><span class="s2">&quot;</span><span class="w"> </span><span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span>

<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Starting script...&quot;</span>

<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Variables set: resourceGroupName=</span><span class="nv">$resourceGroupName</span><span class="s2">, storageAccountName=</span><span class="nv">$storageAccountName</span><span class="s2">, fileShareName=</span><span class="nv">$fileShareName</span><span class="s2">, daysThreshold=</span><span class="nv">$daysThreshold</span><span class="s2">, deleteFile=</span><span class="nv">$deleteFile</span><span class="s2">, sizeFile=</span><span class="nv">$sizeFile</span><span class="s2">&quot;</span>

<span class="c1"># Get the storage account key</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Fetching storage account key...&quot;</span>
<span class="nv">storageAccountKey</span><span class="o">=</span><span class="k">$(</span>az<span class="w"> </span>storage<span class="w"> </span>account<span class="w"> </span>keys<span class="w"> </span>list<span class="w"> </span>--resource-group<span class="w"> </span><span class="nv">$resourceGroupName</span><span class="w"> </span>--account-name<span class="w"> </span><span class="nv">$storageAccountName</span><span class="w"> </span>--query<span class="w"> </span><span class="s1">&#39;[0].value&#39;</span><span class="w"> </span>--output<span class="w"> </span>tsv<span class="k">)</span>
<span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="nv">$?</span><span class="w"> </span>-ne<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Failed to fetch storage account key.&quot;</span>
<span class="w">    </span><span class="nb">exit</span><span class="w"> </span><span class="m">1</span>
<span class="k">fi</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Storage account key fetched successfully.&quot;</span>

<span class="c1"># Get the current date in seconds since epoch and human-readable format</span>
<span class="nv">currentDate</span><span class="o">=</span><span class="k">$(</span>date<span class="w"> </span>+%s<span class="k">)</span>
<span class="nv">humanReadableCurrentDate</span><span class="o">=</span><span class="k">$(</span>date<span class="w"> </span>-d<span class="w"> </span>@<span class="nv">$currentDate</span><span class="w"> </span>+<span class="s2">&quot;%Y-%m-%d %H:%M:%S&quot;</span><span class="k">)</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Current date (epoch): </span><span class="nv">$currentDate</span><span class="s2">&quot;</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Current date (human-readable): </span><span class="nv">$humanReadableCurrentDate</span><span class="s2">&quot;</span>

<span class="c1"># Calculate the threshold date (30 days ago)</span>
<span class="nv">thresholdDate</span><span class="o">=</span><span class="k">$((</span><span class="nv">currentDate</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nv">daysThreshold</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="m">24</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="m">60</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="m">60</span><span class="k">))</span>
<span class="nv">humanReadableThresholdDate</span><span class="o">=</span><span class="k">$(</span>date<span class="w"> </span>-d<span class="w"> </span>@<span class="nv">$thresholdDate</span><span class="w"> </span>+<span class="s2">&quot;%Y-%m-%d %H:%M:%S&quot;</span><span class="k">)</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Threshold date (epoch): </span><span class="nv">$thresholdDate</span><span class="s2">&quot;</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Threshold date (human-readable): </span><span class="nv">$humanReadableThresholdDate</span><span class="s2">&quot;</span>

<span class="c1"># Initialize arrays to store profile directories, sizes, last modified dates, and delete candidates</span>
<span class="nv">oldProfiles</span><span class="o">=()</span>
<span class="nv">profileSizes</span><span class="o">=()</span>
<span class="nv">deleteCandidates</span><span class="o">=()</span>

<span class="c1"># List all directories in the file share</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Listing profile directories...&quot;</span>
<span class="nv">profileDirs</span><span class="o">=</span><span class="k">$(</span>az<span class="w"> </span>storage<span class="w"> </span>file<span class="w"> </span>list<span class="w"> </span>--account-name<span class="w"> </span><span class="nv">$storageAccountName</span><span class="w"> </span>--account-key<span class="w"> </span><span class="nv">$storageAccountKey</span><span class="w"> </span>--share-name<span class="w"> </span><span class="nv">$fileShareName</span><span class="w"> </span>--output<span class="w"> </span>tsv<span class="w"> </span>--query<span class="w"> </span><span class="s1">&#39;[].name&#39;</span><span class="k">)</span>
<span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="nv">$?</span><span class="w"> </span>-ne<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Failed to list profile directories.&quot;</span>
<span class="w">    </span><span class="nb">exit</span><span class="w"> </span><span class="m">1</span>
<span class="k">fi</span>

<span class="c1"># Loop through each profile directory</span>
<span class="nv">profileCount</span><span class="o">=</span><span class="m">0</span>
<span class="k">for</span><span class="w"> </span>profileDir<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="nv">$profileDirs</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="nv">$profileCount</span><span class="w"> </span>-ge<span class="w"> </span><span class="nv">$maxProfiles</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Processed </span><span class="nv">$maxProfiles</span><span class="s2"> profiles. Exiting loop.&quot;</span>
<span class="w">        </span><span class="k">break</span>
<span class="w">    </span><span class="k">fi</span>

<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Processing profile directory: </span><span class="nv">$profileDir</span><span class="s2">&quot;</span>

<span class="w">    </span><span class="c1"># List files in the profile directory</span>
<span class="w">    </span><span class="nv">files</span><span class="o">=</span><span class="k">$(</span>az<span class="w"> </span>storage<span class="w"> </span>file<span class="w"> </span>list<span class="w"> </span>--account-name<span class="w"> </span><span class="nv">$storageAccountName</span><span class="w"> </span>--account-key<span class="w"> </span><span class="nv">$storageAccountKey</span><span class="w"> </span>--share-name<span class="w"> </span><span class="nv">$fileShareName</span><span class="w"> </span>--path<span class="w"> </span><span class="nv">$profileDir</span><span class="w"> </span>--output<span class="w"> </span>tsv<span class="w"> </span>--query<span class="w"> </span><span class="s1">&#39;[].name&#39;</span><span class="k">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="nv">$?</span><span class="w"> </span>-ne<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Failed to list files in </span><span class="nv">$profileDir</span><span class="s2">.&quot;</span>
<span class="w">        </span><span class="k">continue</span>
<span class="w">    </span><span class="k">fi</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span>file<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="nv">$files</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span><span class="nv">$file</span><span class="w"> </span><span class="o">==</span><span class="w"> </span>*.vhdx<span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">            </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Processing file: </span><span class="nv">$file</span><span class="s2">&quot;</span>

<span class="w">            </span><span class="c1"># Get the properties of the .vhdx file</span>
<span class="w">            </span><span class="nv">fileProperties</span><span class="o">=</span><span class="k">$(</span>az<span class="w"> </span>storage<span class="w"> </span>file<span class="w"> </span>show<span class="w"> </span>--account-name<span class="w"> </span><span class="nv">$storageAccountName</span><span class="w"> </span>--account-key<span class="w"> </span><span class="nv">$storageAccountKey</span><span class="w"> </span>--share-name<span class="w"> </span><span class="nv">$fileShareName</span><span class="w"> </span>--path<span class="w"> </span><span class="nv">$profileDir</span>/<span class="nv">$file</span><span class="w"> </span>--query<span class="w"> </span><span class="s1">&#39;{properties: properties}&#39;</span><span class="w"> </span>--output<span class="w"> </span>json<span class="k">)</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="nv">$?</span><span class="w"> </span>-ne<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">                </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Failed to get properties for </span><span class="nv">$file</span><span class="s2">.&quot;</span>
<span class="w">                </span><span class="k">continue</span>
<span class="w">            </span><span class="k">fi</span>

<span class="w">            </span><span class="c1"># Get file size</span>
<span class="w">            </span><span class="nv">fileSize</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$fileProperties</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>jq<span class="w"> </span>-r<span class="w"> </span><span class="s1">&#39;.properties.contentLength&#39;</span><span class="k">)</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="nv">$?</span><span class="w"> </span>-ne<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">                </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Failed to get file size for </span><span class="nv">$file</span><span class="s2">.&quot;</span>
<span class="w">                </span><span class="k">continue</span>
<span class="w">            </span><span class="k">fi</span>
<span class="w">            </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;File size: </span><span class="nv">$fileSize</span><span class="s2"> bytes&quot;</span>

<span class="w">            </span><span class="c1"># Convert file size from bytes to GB</span>
<span class="w">            </span><span class="nv">fileSizeGB</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;scale=2; </span><span class="nv">$fileSize</span><span class="s2"> / (1024 * 1024 * 1024)&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>bc<span class="k">)</span>
<span class="w">            </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;File size: </span><span class="nv">$fileSizeGB</span><span class="s2"> GB&quot;</span>

<span class="w">            </span><span class="c1"># Add profile directory and size to the arrays</span>
<span class="w">            </span><span class="nv">profileSizes</span><span class="o">+=(</span><span class="s2">&quot;</span><span class="nv">$fileSizeGB</span><span class="s2"> </span><span class="nv">$profileDir</span><span class="s2">&quot;</span><span class="o">)</span>

<span class="w">            </span><span class="c1"># Get the last modified date of the file</span>
<span class="w">            </span><span class="nv">lastModified</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$fileProperties</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>jq<span class="w"> </span>-r<span class="w"> </span><span class="s1">&#39;.properties.lastModified&#39;</span><span class="k">)</span>
<span class="w">            </span><span class="nv">lastModifiedDate</span><span class="o">=</span><span class="k">$(</span>date<span class="w"> </span>-d<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$lastModified</span><span class="s2">&quot;</span><span class="w"> </span>+%s<span class="k">)</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="nv">$?</span><span class="w"> </span>-ne<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">                </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Failed to convert last modified date.&quot;</span>
<span class="w">                </span><span class="k">continue</span>
<span class="w">            </span><span class="k">fi</span>
<span class="w">            </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Last modified date (epoch): </span><span class="nv">$lastModifiedDate</span><span class="s2">&quot;</span>

<span class="w">            </span><span class="c1"># Check if the last modified date is older than the threshold</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span><span class="nv">$lastModifiedDate</span><span class="w"> </span>-lt<span class="w"> </span><span class="nv">$thresholdDate</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">                </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Profile </span><span class="nv">$profileDir</span><span class="s2"> has not been updated in the last </span><span class="nv">$daysThreshold</span><span class="s2"> days. Last modified: </span><span class="nv">$lastModified</span><span class="s2">&quot;</span>

<span class="w">                </span><span class="c1"># Convert last modified date to human-readable format</span>
<span class="w">                </span><span class="nv">humanReadableLastModifiedDate</span><span class="o">=</span><span class="k">$(</span>date<span class="w"> </span>-d<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$lastModified</span><span class="s2">&quot;</span><span class="w"> </span>+<span class="s2">&quot;%Y-%m-%d %H:%M:%S&quot;</span><span class="k">)</span>

<span class="w">                </span><span class="c1"># Add profile directory to the delete candidates array</span>
<span class="w">                </span><span class="nv">deleteCandidates</span><span class="o">+=(</span><span class="s2">&quot;</span><span class="nv">$profileDir</span><span class="s2"> - Last Modified: </span><span class="nv">$humanReadableLastModifiedDate</span><span class="s2">&quot;</span><span class="o">)</span>
<span class="w">            </span><span class="k">fi</span>
<span class="w">        </span><span class="k">fi</span>
<span class="w">    </span><span class="k">done</span>
<span class="w">    </span><span class="nv">profileCount</span><span class="o">=</span><span class="k">$((</span><span class="nv">profileCount</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">1</span><span class="k">))</span>
<span class="k">done</span>

<span class="c1"># Sort and write the profile sizes to the size log file</span>
<span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="si">${#</span><span class="nv">profileSizes</span><span class="p">[@]</span><span class="si">}</span><span class="w"> </span>-ne<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Writing profile sizes to </span><span class="nv">$sizeFile</span><span class="s2">...&quot;</span>
<span class="w">    </span><span class="o">{</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Profile directories and their .vhdx file sizes (in GB):&quot;</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;-------------------------------------&quot;</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span>i<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">profileSizes</span><span class="p">[@]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">            </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$i</span><span class="s2">&quot;</span>
<span class="w">        </span><span class="k">done</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sort<span class="w"> </span>-nr<span class="w"> </span>-k1<span class="w"> </span>&gt;<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$sizeFile</span><span class="s2">&quot;</span>
<span class="w">    </span><span class="o">}</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Done writing to </span><span class="nv">$sizeFile</span><span class="s2">.&quot;</span>
<span class="k">else</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;No profiles found with .vhdx files.&quot;</span>
<span class="k">fi</span>

<span class="c1"># Write the outdated profiles to the delete file</span>
<span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="si">${#</span><span class="nv">deleteCandidates</span><span class="p">[@]</span><span class="si">}</span><span class="w"> </span>-ne<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Writing outdated profiles to </span><span class="nv">$deleteFile</span><span class="s2">...&quot;</span>
<span class="w">    </span><span class="o">{</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Profiles that haven&#39;t been updated in the last </span><span class="nv">$daysThreshold</span><span class="s2"> days:&quot;</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Threshold Date (human-readable): </span><span class="nv">$humanReadableThresholdDate</span><span class="s2">&quot;</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Current Date (human-readable): </span><span class="nv">$humanReadableCurrentDate</span><span class="s2">&quot;</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;-------------------------------------&quot;</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span>i<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">deleteCandidates</span><span class="p">[@]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">            </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$i</span><span class="s2">&quot;</span>
<span class="w">        </span><span class="k">done</span>
<span class="w">    </span><span class="o">}</span><span class="w"> </span>&gt;<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$deleteFile</span><span class="s2">&quot;</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Done writing to </span><span class="nv">$deleteFile</span><span class="s2">.&quot;</span>
<span class="k">else</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;No profiles found that are outdated.&quot;</span>
<span class="k">fi</span>

<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Script completed.&quot;</span>
</code></pre></div>
<hr />
<h2 id="step-by-step-explanation">Step-by-Step Explanation</h2>
<ol>
<li><strong>Setup and Variable Initialization:</strong></li>
<li>The script sets up log file names and variables for the resource group, storage account, and file share (all masked for security).</li>
<li>
<p>It determines the script directory and ensures log files are fresh for each run.</p>
</li>
<li>
<p><strong>Fetch Storage Account Key:</strong></p>
</li>
<li>
<p>Uses the Azure CLI to retrieve the storage account key for authentication.</p>
</li>
<li>
<p><strong>Date Calculations:</strong></p>
</li>
<li>
<p>Gets the current date and calculates the threshold date (e.g., 30 days ago) to identify old profiles.</p>
</li>
<li>
<p><strong>List Profile Directories:</strong></p>
</li>
<li>
<p>Uses <code>az storage file list</code> to enumerate all profile directories in the file share.</p>
</li>
<li>
<p><strong>Analyze Each Profile:</strong></p>
</li>
<li>For each profile directory, lists files and looks for <code>.vhdx</code> files (FSLogix containers).</li>
<li>Retrieves file size and last modified date for each <code>.vhdx</code> file.</li>
<li>
<p>If the file hasn't been updated in the threshold period, adds it to the delete candidates list.</p>
</li>
<li>
<p><strong>Log Results:</strong></p>
</li>
<li>Writes a sorted list of profile sizes to a log file for review.</li>
<li>
<p>Writes a list of outdated profiles to a separate file for potential deletion.</p>
</li>
<li>
<p><strong>Output:</strong></p>
</li>
<li>All output is logged for auditing and review before any deletion is performed.</li>
</ol>
<hr />
<h2 id="benefits-of-running-in-a-container">Benefits of Running in a Container</h2>
<ul>
<li><strong>Isolation:</strong> Keeps dependencies and credentials isolated from your local environment.</li>
<li><strong>Portability:</strong> Easily run the script in any environment with Docker or container support.</li>
<li><strong>Security:</strong> Credentials and logs are contained within the container.</li>
</ul>
<hr />
<h2 id="next-steps-deleting-obsolete-profiles">Next Steps: Deleting Obsolete Profiles</h2>
<ul>
<li>Review the generated log files to confirm which profiles are safe to delete.</li>
<li>You can extend this script to delete profiles by using <code>az storage file delete</code> for each candidate.</li>
<li>Always back up or confirm with stakeholders before deleting user data.</li>
</ul>
<hr />
<h2 id="usage-example">Usage Example</h2>
<p>This script is typically run as part of a maintenance workflow, either manually or on a schedule. For example, you might:
- Run the script in a container or Azure Cloud Shell.
- Review the output files (<code>step1-filesize.log</code> and <code>step1-input4step2.txt</code>).
- Use a follow-up script to delete the confirmed obsolete profiles.</p>
<hr />
<p><strong>By regularly cleaning up obsolete FSLogix profiles, you can save on Azure storage costs and keep your environment healthy and efficient.</strong></p>







  
    
  
  


  <aside class="md-source-file">
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="Last update">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date" title="July 7, 2025 15:21:49 UTC">July 7, 2025</span>
  </span>

    
    
    
    
  </aside>





                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": ["navigation.sections", "content.code.annotate", "content.code.copy"], "search": "../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.13a4f30d.min.js"></script>
      
        <script src="../assets/custom.js"></script>
      
    
  </body>
</html>