
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="A professional blog showcasing business problem solutions.">
      
      
      
        <link rel="canonical" href="https://munishsethi.com/monitoring-itsm-integration/">
      
      
        <link rel="prev" href="../meraki-nagios-device-sync/">
      
      
        <link rel="next" href="../meraki-vm-deployment/">
      
      
      <link rel="icon" href="../None">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.14">
    
    
      
        <title>Integrating Monitoring System with ITSM System - Munish(s) Blog</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.342714a4.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/custom.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#integrating-monitoring-system-with-itsm-system" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Munish(s) Blog" class="md-header__button md-logo" aria-label="Munish(s) Blog" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Munish(s) Blog
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Integrating Monitoring System with ITSM System
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Munish(s) Blog" class="md-nav__button md-logo" aria-label="Munish(s) Blog" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Munish(s) Blog
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Azure
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Azure
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../azure-ad-certificate/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Certificate Based Authentication
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../azure-billing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Download Azure Bill
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../azure-resources/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Download Azure Resource
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../azure-query-recovery-services-vault/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Query Recovery Services Vault
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../azure-ad-user/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Entra Users, User Groups and Licence assignments
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../azure-ad-user-devices/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Entra User Devices
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../azure-container-schedule/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Orchestrating Scheduled Jobs (Container Instances)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../devops-build-container/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    DevOps Build Container
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../devops-deploy-container-iac/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    DevOps Deploy Container IaC
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../devops-deploy-container-github-action/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    DevOps Deploy Container Github Actions
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../avd-custon-image-compute-gallery-part1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Building and Publishing an Custom Image
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../avd-publish-part2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Deploying Azure Virtual Desktop (AVD) Desktops
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../avd-cleanup-obsolete-fsLogix-profiles/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Cleanup Obsolete FXLogix Profiles(AVD)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../azure-bcpdr-part1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Business Coninuity Program / Diasister Recovery - Part 1
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../azure-bcpdr-part2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Business Continuity Program / Disaster Recovery - Part 2
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../azure-bcpdr-github-action/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Business Continuity Program / Disaster Recovery - Git Hub Action
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../azure-restore-from-backup-part1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Restore VM from RSV Backup - Part 1
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../azure-restore-from-backup-part2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Restore VM from RSV Backup - Part 2
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Fabric
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Fabric
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../fabric-wharehouse-fact-import/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Warehouse data import
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Cisco Meraki, Nagios XI & Manage Engine
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Cisco Meraki, Nagios XI & Manage Engine
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../meraki-unused-device-sync/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Cisco Meraki Unused Devices
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../meraki-nagios-device-sync/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Cisco Meraki Devices Discovery and Nagios Integration
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Integrating Monitoring System with ITSM System
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Integrating Monitoring System with ITSM System
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#table-of-contents" class="md-nav__link">
    <span class="md-ellipsis">
      Table of Contents
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      Overview
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#non-standard-python-libraries-used" class="md-nav__link">
    <span class="md-ellipsis">
      Non-Standard Python Libraries Used
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#connecting-to-nagios-and-servicedesk-plus-apis" class="md-nav__link">
    <span class="md-ellipsis">
      Connecting to Nagios and ServiceDesk Plus APIs
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#core-integration-workflow" class="md-nav__link">
    <span class="md-ellipsis">
      Core Integration Workflow
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Core Integration Workflow">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#open_and_close_incidents-function" class="md-nav__link">
    <span class="md-ellipsis">
      open_and_close_incidents Function
    </span>
  </a>
  
    <nav class="md-nav" aria-label="open_and_close_incidents Function">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#explanation" class="md-nav__link">
    <span class="md-ellipsis">
      Explanation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#closeincidents-function" class="md-nav__link">
    <span class="md-ellipsis">
      closeincidents Function
    </span>
  </a>
  
    <nav class="md-nav" aria-label="closeincidents Function">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#explanation_1" class="md-nav__link">
    <span class="md-ellipsis">
      Explanation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#openincidents-function" class="md-nav__link">
    <span class="md-ellipsis">
      openincidents Function
    </span>
  </a>
  
    <nav class="md-nav" aria-label="openincidents Function">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#explanation_2" class="md-nav__link">
    <span class="md-ellipsis">
      Explanation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#supporting-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Supporting Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Supporting Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#execute_sql_fetch_dicts" class="md-nav__link">
    <span class="md-ellipsis">
      execute_sql_fetch_dicts
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get_data_from_nagios" class="md-nav__link">
    <span class="md-ellipsis">
      get_data_from_Nagios
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get_all_service_desk_requests" class="md-nav__link">
    <span class="md-ellipsis">
      get_all_Service_Desk_Requests
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delete_nagios_acknowledgement" class="md-nav__link">
    <span class="md-ellipsis">
      delete_nagios_acknowledgement
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#close_request_if_ticket_not_in_comments" class="md-nav__link">
    <span class="md-ellipsis">
      close_Request_if_ticket_not_in_comments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#handle_global_exception" class="md-nav__link">
    <span class="md-ellipsis">
      handle_global_exception
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conclusion" class="md-nav__link">
    <span class="md-ellipsis">
      Conclusion
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../meraki-vm-deployment/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Deploying Cisco Meraki vMX
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Active Directory Domain Services
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Active Directory Domain Services
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../adds-user-creation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Create ADDS User
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../adds-user-update/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Update ADDS User
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    SAP
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            SAP
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../sap-rfc-python-container/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Setup PyRFC in your Container
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../sap-rfc-python/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Calling SAP RFC Function Modules from Python
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../sap-system-start-stop/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Automating SAP System Start/Stop Operations
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    O365
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            O365
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../adaptive-card-consultant-review-part1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Outlook Actionable Adaptive Card - Part 1
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../adaptive-card-consultant-review-part2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Outlook Actionable Adaptive Card - Part 2
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../sharepoint-sites-enumeration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Sharepoint Sites Enumeration
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../sharepoint-site-library-enumeration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Sharepoint Document Library Enumeration
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../sharepoint-site-library-to-azure-fileshare/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Migrate Sharepoint Document Library to Azure File Share
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../sap-concur-expense-reports-aggregation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Concur Expense Report Aggregation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../teams-user-number-assignment/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Get all Teams Phone Assignment(s)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../deprovision-user/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Deprovison User
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tenantallowblocklist/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tenant Allow Block List - False Positive
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../email-o365-proofpoint-part1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    O365 and Proof Point Essentials - Part 1
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../email-o365-proofpoint-part2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    O365 and Proof Point Essentials - Part 2
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../email-o365-proofpoint-part3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    O365 and Proof Point Essentials - Part 3
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../email-o365-proofpoint-part4/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    O365 and Proof Point Essentials - Part 4
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../email-o365-proofpoint-part5/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    O365 and Proof Point Essentials - Part 5
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    UKG
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            UKG
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ukg-sftp-file-transfer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Secure File Transfer with UKG Dimensions
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ukg-api-employee-verification/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Employee Verification via API
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ukg-api-integration-and-dataview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Automating Integration Execution and Dataview extract
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9" >
        
          
          <label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Misc
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9">
            <span class="md-nav__icon md-icon"></span>
            Misc
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../proofpoint-user-management/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Proof Point User Management
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../github-clean-deployments/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Clean GitHub Deployments
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../proofpointo365connector/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Understanding DMARC/Spoofing, O365 with ProofPoint
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#table-of-contents" class="md-nav__link">
    <span class="md-ellipsis">
      Table of Contents
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      Overview
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#non-standard-python-libraries-used" class="md-nav__link">
    <span class="md-ellipsis">
      Non-Standard Python Libraries Used
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#connecting-to-nagios-and-servicedesk-plus-apis" class="md-nav__link">
    <span class="md-ellipsis">
      Connecting to Nagios and ServiceDesk Plus APIs
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#core-integration-workflow" class="md-nav__link">
    <span class="md-ellipsis">
      Core Integration Workflow
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Core Integration Workflow">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#open_and_close_incidents-function" class="md-nav__link">
    <span class="md-ellipsis">
      open_and_close_incidents Function
    </span>
  </a>
  
    <nav class="md-nav" aria-label="open_and_close_incidents Function">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#explanation" class="md-nav__link">
    <span class="md-ellipsis">
      Explanation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#closeincidents-function" class="md-nav__link">
    <span class="md-ellipsis">
      closeincidents Function
    </span>
  </a>
  
    <nav class="md-nav" aria-label="closeincidents Function">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#explanation_1" class="md-nav__link">
    <span class="md-ellipsis">
      Explanation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#openincidents-function" class="md-nav__link">
    <span class="md-ellipsis">
      openincidents Function
    </span>
  </a>
  
    <nav class="md-nav" aria-label="openincidents Function">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#explanation_2" class="md-nav__link">
    <span class="md-ellipsis">
      Explanation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#supporting-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Supporting Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Supporting Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#execute_sql_fetch_dicts" class="md-nav__link">
    <span class="md-ellipsis">
      execute_sql_fetch_dicts
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get_data_from_nagios" class="md-nav__link">
    <span class="md-ellipsis">
      get_data_from_Nagios
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get_all_service_desk_requests" class="md-nav__link">
    <span class="md-ellipsis">
      get_all_Service_Desk_Requests
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delete_nagios_acknowledgement" class="md-nav__link">
    <span class="md-ellipsis">
      delete_nagios_acknowledgement
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#close_request_if_ticket_not_in_comments" class="md-nav__link">
    <span class="md-ellipsis">
      close_Request_if_ticket_not_in_comments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#handle_global_exception" class="md-nav__link">
    <span class="md-ellipsis">
      handle_global_exception
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conclusion" class="md-nav__link">
    <span class="md-ellipsis">
      Conclusion
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="integrating-monitoring-system-with-itsm-system">Integrating Monitoring System with ITSM System</h1>
<p>This technical article provides a comprehensive, vendor-neutral guide to integrating a monitoring system (Nagios) with an ITSM system (ServiceDesk Plus by ManageEngine) using Python. The solution demonstrates how to automatically open and close ITSM tickets based on monitoring events, with all relevant code and in-line explanations. </p>
<hr />
<h2 id="table-of-contents">Table of Contents</h2>
<ol>
<li><a href="#overview">Overview</a></li>
<li><a href="#non-standard-python-libraries-used">Non-Standard Python Libraries Used</a></li>
<li><a href="#connecting-to-nagios-and-servicedesk-plus-apis">Connecting to Nagios and ServiceDesk Plus APIs</a></li>
<li><a href="#core-integration-workflow">Core Integration Workflow</a><ul>
<li><a href="#open_and_close_incidents-function">open_and_close_incidents Function</a></li>
<li><a href="#closeincidents-function">closeincidents Function</a></li>
<li><a href="#openincidents-function">openincidents Function</a></li>
</ul>
</li>
<li><a href="#supporting-functions">Supporting Functions</a></li>
<li><a href="#conclusion">Conclusion</a></li>
</ol>
<hr />
<h2 id="overview">Overview</h2>
<p>Automating the integration between a monitoring system (such as Nagios) and an ITSM tool (such as ServiceDesk Plus) enables organizations to streamline incident management. This integration ensures that alerts from the monitoring system automatically generate, update, or close tickets in the ITSM tool, reducing manual effort and improving response times.</p>
<p>This article provides a step-by-step guide, including all relevant Python code, to:
- Connect to both Nagios and ServiceDesk Plus via their APIs
- Open tickets in the ITSM tool when monitoring events occur
- Close tickets in the ITSM tool when issues are resolved in the monitoring system</p>
<hr />
<h2 id="non-standard-python-libraries-used">Non-Standard Python Libraries Used</h2>
<p>The following non-standard Python libraries are used in this solution:</p>
<ul>
<li><code>requests</code>: For making HTTP requests to Nagios and ServiceDesk Plus APIs</li>
<li><code>datetime</code>, <code>calendar</code>: For date and time manipulations</li>
<li><code>csv</code>: For exporting data to CSV (if needed)</li>
</ul>
<p>Install these libraries using pip if not already available:</p>
<div class="highlight"><pre><span></span><code>pip<span class="w"> </span>install<span class="w"> </span>requests
</code></pre></div>
<hr />
<h2 id="connecting-to-nagios-and-servicedesk-plus-apis">Connecting to Nagios and ServiceDesk Plus APIs</h2>
<p>To interact with both systems, you need API endpoints and credentials. Below are example constants (replace with your own values):</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Constants for ServiceDesk Plus (ITSM)</span>
<span class="n">SERVICE_DESK_API_KEY</span> <span class="o">=</span> <span class="s1">&#39;YOUR_SERVICEDESKPLUS_API_KEY&#39;</span>
<span class="n">SERVICEDESK_BASE_URL</span> <span class="o">=</span> <span class="s1">&#39;https://your-servicedeskplus-instance/api/v3/&#39;</span>
<span class="n">SERVICE_DESK_USER</span> <span class="o">=</span> <span class="s1">&#39;automation_user&#39;</span>  <span class="c1"># The user that creates tickets via API</span>

<span class="c1"># Constants for Nagios</span>
<span class="n">NAGIOS_API_KEY</span> <span class="o">=</span> <span class="s1">&#39;YOUR_NAGIOS_API_KEY&#39;</span>
<span class="n">NAGIOSXI_BASE_URL</span> <span class="o">=</span> <span class="s1">&#39;https://your-nagios-instance/nagiosxi/api/v1/&#39;</span>
<span class="n">NAGIOS_COMMENT_FORMAT</span> <span class="o">=</span> <span class="s1">&#39;Automated Ticket Number Added By Interface Engine &#39;</span>
</code></pre></div>
<hr />
<h2 id="core-integration-workflow">Core Integration Workflow</h2>
<p>The main workflow is orchestrated by the <code>open_and_close_incidents</code> function, which:
- Retrieves the current Nagios host inventory from a database
- Fetches the current state of monitored hosts and services from Nagios
- Closes incidents in the ITSM tool if the corresponding monitoring issue is resolved
- Opens new incidents in the ITSM tool for new monitoring issues</p>
<h3 id="open_and_close_incidents-function">open_and_close_incidents Function</h3>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">open_and_close_incidents</span><span class="p">():</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Retrieve Nagios host inventory from a database</span>
        <span class="n">nagioshostinventory</span> <span class="o">=</span> <span class="n">execute_sql_fetch_dicts</span><span class="p">(</span><span class="s1">&#39;select lower(host_name) as host_name, notes from fact_nagios_hosts &#39;</span><span class="p">)</span>
        <span class="c1"># Fetch current Nagios host group members via API</span>
        <span class="n">nagioshostgroupmembers</span> <span class="o">=</span> <span class="n">get_data_from_Nagios</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;objects/hostgroupmembers&#39;</span><span class="p">,</span> <span class="s1">&#39;hostgroup&#39;</span><span class="p">)</span>

        <span class="c1"># Close incidents in ITSM tool for resolved monitoring issues</span>
        <span class="n">hostandservicesjustclosed</span> <span class="o">=</span> <span class="n">closeincidents</span><span class="p">(</span><span class="n">nagioshostgroupmembers</span><span class="p">)</span>
        <span class="c1"># Open new incidents in ITSM tool for new monitoring issues</span>
        <span class="n">openincidents</span><span class="p">(</span><span class="n">nagioshostgroupmembers</span><span class="p">,</span> <span class="n">nagioshostinventory</span><span class="p">,</span> <span class="n">hostandservicesjustclosed</span><span class="p">)</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">localExceptionObject</span><span class="p">:</span>
        <span class="n">handle_global_exception</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">_getframe</span><span class="p">()</span><span class="o">.</span><span class="n">f_code</span><span class="o">.</span><span class="n">co_name</span><span class="p">,</span> <span class="n">localExceptionObject</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="k">pass</span>
</code></pre></div>
<h4 id="explanation">Explanation</h4>
<ul>
<li><strong>execute_sql_fetch_dicts</strong>: Retrieves the current Nagios host inventory from a database table.</li>
<li><strong>get_data_from_Nagios</strong>: Calls the Nagios API to get host group membership information.</li>
<li><strong>closeincidents</strong>: Handles closing tickets in the ITSM tool for issues that have been resolved in Nagios.</li>
<li><strong>openincidents</strong>: Handles opening new tickets in the ITSM tool for new issues detected by Nagios.</li>
</ul>
<hr />
<h3 id="closeincidents-function">closeincidents Function</h3>
<p>This function closes tickets in the ITSM tool when the corresponding monitoring issue is resolved in Nagios.</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">closeincidents</span><span class="p">(</span><span class="n">nagioshostgroupmembers</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Calculate timestamp for incidents created in the last 10 days</span>
        <span class="n">twoweeksago</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">-</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        <span class="n">twoweeksago</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">calendar</span><span class="o">.</span><span class="n">timegm</span><span class="p">(</span><span class="n">twoweeksago</span><span class="o">.</span><span class="n">timetuple</span><span class="p">()))</span> <span class="o">+</span> <span class="s1">&#39;000&#39;</span>
        <span class="c1"># Search for resolved/closed/cancelled tickets created by the automation user</span>
        <span class="n">searchcrteria</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">{</span><span class="s2">&quot;field&quot;</span><span class="p">:</span> <span class="s2">&quot;status.name&quot;</span><span class="p">,</span> <span class="s2">&quot;condition&quot;</span><span class="p">:</span> <span class="s2">&quot;is &quot;</span><span class="p">,</span> <span class="s2">&quot;values&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Resolved&quot;</span><span class="p">,</span> <span class="s2">&quot;Closed&quot;</span><span class="p">,</span> <span class="s2">&quot;Cancelled&quot;</span><span class="p">]},</span>
            <span class="p">{</span><span class="s2">&quot;field&quot;</span><span class="p">:</span> <span class="s2">&quot;created_by.name&quot;</span><span class="p">,</span> <span class="s2">&quot;condition&quot;</span><span class="p">:</span> <span class="s2">&quot;is&quot;</span><span class="p">,</span> <span class="s2">&quot;logical_operator&quot;</span><span class="p">:</span> <span class="s2">&quot;and&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">SERVICE_DESK_USER</span><span class="p">)},</span>
            <span class="p">{</span><span class="s2">&quot;field&quot;</span><span class="p">:</span> <span class="s2">&quot;created_time&quot;</span><span class="p">,</span> <span class="s2">&quot;condition&quot;</span><span class="p">:</span> <span class="s2">&quot;greater than&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="n">twoweeksago</span><span class="p">,</span> <span class="s2">&quot;logical_operator&quot;</span><span class="p">:</span> <span class="s2">&quot;and&quot;</span><span class="p">}</span>
        <span class="p">]</span>
        <span class="n">servicedeskincidents</span> <span class="o">=</span> <span class="n">get_all_Service_Desk_Requests</span><span class="p">(</span><span class="s1">&#39;requests&#39;</span><span class="p">,</span> <span class="s1">&#39;requests&#39;</span><span class="p">,</span> <span class="n">searchcrteria</span><span class="p">,</span> <span class="n">SERVICE_DESK_API_KEY</span><span class="p">,</span> <span class="n">SERVICEDESK_BASE_URL</span><span class="p">)</span>
        <span class="n">nagiosallcurrentcomments</span> <span class="o">=</span> <span class="n">get_data_from_Nagios</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;objects/comment&#39;</span><span class="p">,</span> <span class="s1">&#39;comment&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">eachNagiosComment</span> <span class="ow">in</span> <span class="n">nagiosallcurrentcomments</span><span class="p">:</span>
            <span class="n">commentData</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">eachNagiosComment</span><span class="p">[</span><span class="s1">&#39;comment_data&#39;</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">NAGIOS_COMMENT_FORMAT</span> <span class="ow">in</span> <span class="n">commentData</span><span class="p">:</span>
                <span class="n">nagiosticketnumber</span> <span class="o">=</span> <span class="n">commentData</span><span class="p">[(</span><span class="nb">len</span><span class="p">(</span><span class="n">NAGIOS_COMMENT_FORMAT</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">commentData</span><span class="p">)):]</span>
                <span class="n">deleteNagiosAcknowledgement</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">for</span> <span class="n">eachiSightRequest</span> <span class="ow">in</span> <span class="n">servicedeskincidents</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">eachiSightRequest</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">nagiosticketnumber</span><span class="p">:</span>
                        <span class="n">deleteNagiosAcknowledgement</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="k">break</span>
                <span class="k">if</span> <span class="n">deleteNagiosAcknowledgement</span><span class="p">:</span>
                    <span class="n">delete_nagios_acknowledgement</span><span class="p">(</span><span class="n">eachNagiosComment</span><span class="p">[</span><span class="s1">&#39;host_name&#39;</span><span class="p">],</span> <span class="n">eachNagiosComment</span><span class="p">[</span><span class="s1">&#39;service_description&#39;</span><span class="p">])</span>
        <span class="c1"># Close requests in ITSM tool if not present in Nagios comments</span>
        <span class="k">for</span> <span class="n">eachiSightRequest</span> <span class="ow">in</span> <span class="n">servicedeskincidents</span><span class="p">:</span>
            <span class="n">hname</span><span class="p">,</span> <span class="n">sname</span><span class="p">,</span> <span class="n">onerowaffected</span> <span class="o">=</span> <span class="n">close_Request_if_ticket_not_in_comments</span><span class="p">(</span><span class="n">eachiSightRequest</span><span class="p">,</span> <span class="n">nagiosallcurrentcomments</span><span class="p">,</span> <span class="n">nagioshostgroupmembers</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">onerowaffected</span> <span class="ow">and</span> <span class="n">hname</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">hostandservicesjustclosed</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;hname&quot;</span><span class="p">:</span> <span class="n">hname</span><span class="p">,</span> <span class="s2">&quot;sname&quot;</span><span class="p">:</span> <span class="n">sname</span><span class="p">})</span>
        <span class="c1"># Repeat for open tickets</span>
        <span class="n">searchcrteria</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">{</span><span class="s2">&quot;field&quot;</span><span class="p">:</span> <span class="s2">&quot;status.name&quot;</span><span class="p">,</span> <span class="s2">&quot;condition&quot;</span><span class="p">:</span> <span class="s2">&quot;is not&quot;</span><span class="p">,</span> <span class="s2">&quot;values&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Resolved&quot;</span><span class="p">,</span> <span class="s2">&quot;Closed&quot;</span><span class="p">,</span> <span class="s2">&quot;Cancelled&quot;</span><span class="p">]},</span>
            <span class="p">{</span><span class="s2">&quot;field&quot;</span><span class="p">:</span> <span class="s2">&quot;created_by.name&quot;</span><span class="p">,</span> <span class="s2">&quot;condition&quot;</span><span class="p">:</span> <span class="s2">&quot;is&quot;</span><span class="p">,</span> <span class="s2">&quot;logical_operator&quot;</span><span class="p">:</span> <span class="s2">&quot;and&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">SERVICE_DESK_USER</span><span class="p">)}</span>
        <span class="p">]</span>
        <span class="n">servicedeskincidents</span> <span class="o">=</span> <span class="n">get_all_Service_Desk_Requests</span><span class="p">(</span><span class="s1">&#39;requests&#39;</span><span class="p">,</span> <span class="s1">&#39;requests&#39;</span><span class="p">,</span> <span class="n">searchcrteria</span><span class="p">,</span> <span class="n">SERVICE_DESK_API_KEY</span><span class="p">,</span> <span class="n">SERVICEDESK_BASE_URL</span><span class="p">)</span>
        <span class="n">nagiosallcurrentcomments</span> <span class="o">=</span> <span class="n">get_data_from_Nagios</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;objects/comment&#39;</span><span class="p">,</span> <span class="s1">&#39;comment&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">eachiSightRequest</span> <span class="ow">in</span> <span class="n">servicedeskincidents</span><span class="p">:</span>
            <span class="n">hname</span><span class="p">,</span> <span class="n">sname</span><span class="p">,</span> <span class="n">onerowaffected</span> <span class="o">=</span> <span class="n">close_Request_if_ticket_not_in_comments</span><span class="p">(</span><span class="n">eachiSightRequest</span><span class="p">,</span> <span class="n">nagiosallcurrentcomments</span><span class="p">,</span> <span class="n">nagioshostgroupmembers</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">onerowaffected</span> <span class="ow">and</span> <span class="n">hname</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">hostandservicesjustclosed</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;hname&quot;</span><span class="p">:</span> <span class="n">hname</span><span class="p">,</span> <span class="s2">&quot;sname&quot;</span><span class="p">:</span> <span class="n">sname</span><span class="p">})</span>
        <span class="k">return</span> <span class="n">hostandservicesjustclosed</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">localExceptionObject</span><span class="p">:</span>
        <span class="n">handle_global_exception</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">_getframe</span><span class="p">()</span><span class="o">.</span><span class="n">f_code</span><span class="o">.</span><span class="n">co_name</span><span class="p">,</span> <span class="n">localExceptionObject</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="k">pass</span>
</code></pre></div>
<h4 id="explanation_1">Explanation</h4>
<ul>
<li><strong>get_all_Service_Desk_Requests</strong>: Queries the ITSM tool for tickets matching certain criteria.</li>
<li><strong>get_data_from_Nagios</strong>: Retrieves current comments (acknowledgements) from Nagios.</li>
<li><strong>delete_nagios_acknowledgement</strong>: Removes acknowledgement in Nagios if the corresponding ticket is resolved.</li>
<li><strong>close_Request_if_ticket_not_in_comments</strong>: Closes the ITSM ticket if it is no longer present in Nagios comments.</li>
</ul>
<hr />
<h3 id="openincidents-function">openincidents Function</h3>
<p>This function opens new tickets in the ITSM tool for new monitoring issues detected by Nagios.</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">openincidents</span><span class="p">(</span><span class="n">nagioshostgroupmembers</span><span class="p">,</span> <span class="n">nagioshostinventory</span><span class="p">,</span> <span class="n">hostandservicesjustclosed</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># ...implementation to open new tickets in ITSM tool based on Nagios alerts...</span>
        <span class="c1"># Typically, this involves:</span>
        <span class="c1"># 1. Fetching current Nagios issues (hosts/services in warning/critical state)</span>
        <span class="c1"># 2. Checking if a ticket already exists for the issue</span>
        <span class="c1"># 3. If not, creating a new ticket in the ITSM tool via API</span>
        <span class="c1"># 4. Adding a comment/acknowledgement in Nagios with the ticket number</span>
        <span class="k">pass</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">localExceptionObject</span><span class="p">:</span>
        <span class="n">handle_global_exception</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">_getframe</span><span class="p">()</span><span class="o">.</span><span class="n">f_code</span><span class="o">.</span><span class="n">co_name</span><span class="p">,</span> <span class="n">localExceptionObject</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="k">pass</span>
</code></pre></div>
<h4 id="explanation_2">Explanation</h4>
<ul>
<li><strong>openincidents</strong> is responsible for creating new tickets in the ITSM tool for issues detected by Nagios that do not already have an open ticket.</li>
<li>The function typically fetches current issues from Nagios, checks for existing tickets, and creates new ones as needed.</li>
</ul>
<hr />
<h2 id="supporting-functions">Supporting Functions</h2>
<p>Below are key supporting functions referenced in the workflow. These functions handle API calls, database queries, and other integration logic.</p>
<h3 id="execute_sql_fetch_dicts">execute_sql_fetch_dicts</h3>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">execute_sql_fetch_dicts</span><span class="p">(</span><span class="n">sqlstatement</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Executes a SQL query and returns the results as a list of dictionaries.</span>
<span class="sd">    Implementation depends on your database setup. Example below uses pyodbc.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">pyodbc</span>
    <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Replace with your actual connection string</span>
        <span class="n">conn</span> <span class="o">=</span> <span class="n">pyodbc</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;DRIVER={ODBC Driver 17 for SQL Server};SERVER=your_server;DATABASE=your_db;UID=your_user;PWD=your_password&#39;</span><span class="p">)</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sqlstatement</span><span class="p">)</span>
        <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">column</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">cursor</span><span class="o">.</span><span class="n">description</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">():</span>
            <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">columns</span><span class="p">,</span> <span class="n">row</span><span class="p">)))</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SQL execution error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>
    <span class="k">return</span> <span class="n">results</span>
</code></pre></div>
<h3 id="get_data_from_nagios">get_data_from_Nagios</h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>

<span class="k">def</span><span class="w"> </span><span class="nf">get_data_from_Nagios</span><span class="p">(</span><span class="n">queryParms</span><span class="p">,</span> <span class="n">object2Query</span><span class="p">,</span> <span class="n">responseField</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calls the Nagios API and returns the requested data.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;apikey&#39;</span><span class="p">:</span> <span class="n">NAGIOS_API_KEY</span><span class="p">}</span>
        <span class="k">if</span> <span class="n">queryParms</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">params</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">queryParms</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">NAGIOSXI_BASE_URL</span> <span class="o">+</span> <span class="n">object2Query</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">response_content</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span>
        <span class="n">json_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">response_content</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">responseField</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">json_data</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">json_data</span><span class="p">[</span><span class="n">responseField</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Nagios API error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>
</code></pre></div>
<h3 id="get_all_service_desk_requests">get_all_Service_Desk_Requests</h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>

<span class="k">def</span><span class="w"> </span><span class="nf">get_all_Service_Desk_Requests</span><span class="p">(</span><span class="n">object2Query</span><span class="p">,</span> <span class="n">responseField</span><span class="p">,</span> <span class="n">searchcriteria</span><span class="p">,</span> <span class="n">apikey</span><span class="p">,</span> <span class="n">apibaseurl</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calls the ServiceDesk Plus API to retrieve tickets matching the search criteria.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Authtoken&#39;</span><span class="p">:</span> <span class="n">apikey</span><span class="p">}</span>
        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">apibaseurl</span><span class="si">}{</span><span class="n">object2Query</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;input_data&quot;</span><span class="p">:</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s2">&quot;criteria&quot;</span><span class="p">:</span> <span class="n">searchcriteria</span><span class="p">})}</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">)</span>
        <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">responseField</span><span class="p">,</span> <span class="p">[])</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ServiceDesk API error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[]</span>
</code></pre></div>
<h3 id="delete_nagios_acknowledgement">delete_nagios_acknowledgement</h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>

<span class="k">def</span><span class="w"> </span><span class="nf">delete_nagios_acknowledgement</span><span class="p">(</span><span class="n">hostname</span><span class="p">,</span> <span class="n">servicedescription</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Removes an acknowledgement (comment) from Nagios for the given host/service.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">servicedescription</span><span class="p">:</span>
            <span class="n">nagiosCommand</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;cmd=REMOVE_HOST_ACKNOWLEDGEMENT;</span><span class="si">{</span><span class="n">hostname</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">nagiosCommand</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;cmd=REMOVE_SVC_ACKNOWLEDGEMENT;</span><span class="si">{</span><span class="n">hostname</span><span class="si">}</span><span class="s1">;</span><span class="si">{</span><span class="n">servicedescription</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">:</span> <span class="s1">&#39;application/x-www-form-urlencoded&#39;</span><span class="p">}</span>
        <span class="n">OBJECT_URL</span> <span class="o">=</span> <span class="s1">&#39;system/corecommand&#39;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
            <span class="n">NAGIOSXI_BASE_URL</span> <span class="o">+</span> <span class="n">OBJECT_URL</span><span class="p">,</span>
            <span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;apikey&#39;</span><span class="p">:</span> <span class="n">NAGIOS_API_KEY</span><span class="p">},</span>
            <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span>
            <span class="n">data</span><span class="o">=</span><span class="n">nagiosCommand</span><span class="p">,</span>
            <span class="n">verify</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Nagios acknowledgement deletion error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>
</code></pre></div>
<h3 id="close_request_if_ticket_not_in_comments">close_Request_if_ticket_not_in_comments</h3>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">close_Request_if_ticket_not_in_comments</span><span class="p">(</span><span class="n">iSightRequest</span><span class="p">,</span> <span class="n">nagiosallcurrentcomments</span><span class="p">,</span> <span class="n">nagioshostgroupmembers</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Closes the ITSM ticket if it is no longer present in Nagios comments.</span>
<span class="sd">    Returns (hostname, servicename, rowaffected)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">lookforRequestNumber</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">iSightRequest</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">])</span>
    <span class="n">closerequest</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">hostname</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">servicename</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">onerowaffected</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">for</span> <span class="n">eachNagiosComment</span> <span class="ow">in</span> <span class="n">nagiosallcurrentcomments</span><span class="p">:</span>
        <span class="n">commentData</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">eachNagiosComment</span><span class="p">[</span><span class="s1">&#39;comment_data&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">lookforRequestNumber</span> <span class="ow">in</span> <span class="n">commentData</span><span class="p">:</span>
            <span class="n">closerequest</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">break</span>
    <span class="k">if</span> <span class="n">closerequest</span><span class="p">:</span>
        <span class="c1"># Here you would call the ITSM API to close the ticket</span>
        <span class="c1"># For demonstration, we just print and return</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Closing ITSM ticket </span><span class="si">{</span><span class="n">lookforRequestNumber</span><span class="si">}</span><span class="s2"> as it is not present in Nagios comments.&quot;</span><span class="p">)</span>
        <span class="n">onerowaffected</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="c1"># Optionally, update the ticket status via API here</span>
    <span class="k">return</span> <span class="n">hostname</span><span class="p">,</span> <span class="n">servicename</span><span class="p">,</span> <span class="n">onerowaffected</span>
</code></pre></div>
<h3 id="handle_global_exception">handle_global_exception</h3>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">handle_global_exception</span><span class="p">(</span><span class="n">functionName</span><span class="p">,</span> <span class="n">exceptionObject</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Handles exceptions and sends notification emails if needed.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">traceback</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Exception in </span><span class="si">{</span><span class="n">functionName</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">exceptionObject</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">())</span>
    <span class="c1"># Optionally, send an email notification here</span>
    <span class="c1"># send_email(recipients=[...], subject=&#39;Exception occurred&#39;, plain_message=str(exceptionObject))</span>
</code></pre></div>
<hr />
<h2 id="conclusion">Conclusion</h2>
<p>By following the approach and code provided in this article, you can automate the integration between your monitoring system (Nagios) and ITSM tool (ServiceDesk Plus or similar). This enables automatic ticket creation and closure based on real-time monitoring events, improving incident response and reducing manual workload.</p>
<p>Adapt the code and API calls as needed for your specific environment and ITSM/monitoring platforms.</p>







  
    
  
  


  <aside class="md-source-file">
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="Last update">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date" title="July 7, 2025 15:21:49 UTC">July 7, 2025</span>
  </span>

    
    
    
    
  </aside>





                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": ["navigation.sections", "content.code.annotate", "content.code.copy"], "search": "../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.13a4f30d.min.js"></script>
      
        <script src="../assets/custom.js"></script>
      
    
  </body>
</html>