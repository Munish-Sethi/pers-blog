
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="A professional blog showcasing business problem solutions.">
      
      
      
        <link rel="canonical" href="https://munishsethi.com/proofpointo365connector/">
      
      
        <link rel="prev" href="../github-clean-deployments/">
      
      
      
      <link rel="icon" href="../None">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.14">
    
    
      
        <title>Understanding DMARC/Spoofing, O365 with ProofPoint - Munish(s) Blog</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.342714a4.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/custom.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#understanding-spf-dkim-and-dmarc-in-o365-with-proofpoint-preventing-spoofing-and-bypass-attacks" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Munish(s) Blog" class="md-header__button md-logo" aria-label="Munish(s) Blog" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Munish(s) Blog
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Understanding DMARC/Spoofing, O365 with ProofPoint
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Munish(s) Blog" class="md-nav__button md-logo" aria-label="Munish(s) Blog" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Munish(s) Blog
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Azure
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Azure
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../azure-ad-certificate/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Certificate Based Authentication
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../azure-billing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Download Azure Bill
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../azure-resources/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Download Azure Resource
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../azure-query-recovery-services-vault/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Query Recovery Services Vault
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../azure-ad-user/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Entra Users, User Groups and Licence assignments
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../azure-ad-user-devices/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Entra User Devices
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../azure-container-schedule/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Orchestrating Scheduled Jobs (Container Instances)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../devops-build-container/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    DevOps Build Container
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../devops-deploy-container-iac/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    DevOps Deploy Container IaC
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../devops-deploy-container-github-action/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    DevOps Deploy Container Github Actions
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../avd-custon-image-compute-gallery-part1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Building and Publishing an Custom Image
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../avd-publish-part2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Deploying Azure Virtual Desktop (AVD) Desktops
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../avd-cleanup-obsolete-fsLogix-profiles/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Cleanup Obsolete FXLogix Profiles(AVD)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../azure-bcpdr-part1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Business Coninuity Program / Diasister Recovery - Part 1
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../azure-bcpdr-part2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Business Continuity Program / Disaster Recovery - Part 2
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../azure-bcpdr-github-action/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Business Continuity Program / Disaster Recovery - Git Hub Action
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../azure-restore-from-backup-part1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Restore VM from RSV Backup - Part 1
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../azure-restore-from-backup-part2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Restore VM from RSV Backup - Part 2
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Fabric
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Fabric
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../fabric-wharehouse-fact-import/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Warehouse data import
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Cisco Meraki, Nagios XI & Manage Engine
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Cisco Meraki, Nagios XI & Manage Engine
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../meraki-unused-device-sync/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Cisco Meraki Unused Devices
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../meraki-nagios-device-sync/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Cisco Meraki Devices Discovery and Nagios Integration
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../monitoring-itsm-integration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Integrating Monitoring System with ITSM System
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../meraki-vm-deployment/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Deploying Cisco Meraki vMX
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Active Directory Domain Services
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Active Directory Domain Services
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../adds-user-creation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Create ADDS User
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../adds-user-update/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Update ADDS User
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    SAP
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            SAP
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../sap-rfc-python-container/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Setup PyRFC in your Container
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../sap-rfc-python/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Calling SAP RFC Function Modules from Python
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../sap-system-start-stop/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Automating SAP System Start/Stop Operations
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    O365
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            O365
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../adaptive-card-consultant-review-part1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Outlook Actionable Adaptive Card - Part 1
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../adaptive-card-consultant-review-part2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Outlook Actionable Adaptive Card - Part 2
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../sharepoint-sites-enumeration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Sharepoint Sites Enumeration
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../sharepoint-site-library-enumeration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Sharepoint Document Library Enumeration
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../sharepoint-site-library-to-azure-fileshare/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Migrate Sharepoint Document Library to Azure File Share
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../sap-concur-expense-reports-aggregation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Concur Expense Report Aggregation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../teams-user-number-assignment/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Get all Teams Phone Assignment(s)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../deprovision-user/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Deprovison User
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tenantallowblocklist/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tenant Allow Block List - False Positive
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../email-o365-proofpoint-part1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    O365 and Proof Point Essentials - Part 1
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../email-o365-proofpoint-part2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    O365 and Proof Point Essentials - Part 2
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../email-o365-proofpoint-part3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    O365 and Proof Point Essentials - Part 3
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../email-o365-proofpoint-part4/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    O365 and Proof Point Essentials - Part 4
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    UKG
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            UKG
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ukg-sftp-file-transfer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Secure File Transfer with UKG Dimensions
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ukg-api-employee-verification/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Employee Verification via API
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ukg-api-integration-and-dataview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Automating Integration Execution and Dataview extract
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9" checked>
        
          
          <label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Misc
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_9">
            <span class="md-nav__icon md-icon"></span>
            Misc
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../proofpoint-user-management/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Proof Point User Management
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../github-clean-deployments/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Clean GitHub Deployments
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Understanding DMARC/Spoofing, O365 with ProofPoint
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Understanding DMARC/Spoofing, O365 with ProofPoint
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    <span class="md-ellipsis">
      Introduction
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#1-email-flow-architecture" class="md-nav__link">
    <span class="md-ellipsis">
      1. Email Flow Architecture
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1. Email Flow Architecture">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-bypass-problem-explained" class="md-nav__link">
    <span class="md-ellipsis">
      The Bypass Problem Explained
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-spf-dkim-and-dmarc-explained" class="md-nav__link">
    <span class="md-ellipsis">
      2. SPF, DKIM, and DMARC Explained
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2. SPF, DKIM, and DMARC Explained">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#spf-sender-policy-framework" class="md-nav__link">
    <span class="md-ellipsis">
      SPF (Sender Policy Framework)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dkim-domainkeys-identified-mail" class="md-nav__link">
    <span class="md-ellipsis">
      DKIM (DomainKeys Identified Mail)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dmarc-domain-based-message-authentication-reporting-and-conformance" class="md-nav__link">
    <span class="md-ellipsis">
      DMARC (Domain-based Message Authentication, Reporting, and Conformance)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-the-problem-spoofing-despite-dmarc-quarantine" class="md-nav__link">
    <span class="md-ellipsis">
      3. The Problem: Spoofing Despite DMARC Quarantine
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3. The Problem: Spoofing Despite DMARC Quarantine">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#why-this-happens" class="md-nav__link">
    <span class="md-ellipsis">
      Why This Happens
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#real-world-example-teams-meeting-forward-issue" class="md-nav__link">
    <span class="md-ellipsis">
      Real-World Example: Teams Meeting Forward Issue
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-evolution-from-quarantine-to-redirect-approach" class="md-nav__link">
    <span class="md-ellipsis">
      4. Evolution from Quarantine to Redirect Approach
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4. Evolution from Quarantine to Redirect Approach">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#initial-quarantine-approach-problematic" class="md-nav__link">
    <span class="md-ellipsis">
      Initial Quarantine Approach (Problematic)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#problems-with-the-quarantine-approach" class="md-nav__link">
    <span class="md-ellipsis">
      Problems with the Quarantine Approach
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-better-solution-redirect-approach" class="md-nav__link">
    <span class="md-ellipsis">
      The Better Solution: Redirect Approach
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-allowing-legitimate-internal-applications" class="md-nav__link">
    <span class="md-ellipsis">
      5. Allowing Legitimate Internal Applications
    </span>
  </a>
  
    <nav class="md-nav" aria-label="5. Allowing Legitimate Internal Applications">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#step-by-step-creating-a-connector-in-o365" class="md-nav__link">
    <span class="md-ellipsis">
      Step-by-Step: Creating a Connector in O365
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-the-complete-redirect-based-security-solution" class="md-nav__link">
    <span class="md-ellipsis">
      6. The Complete Redirect-Based Security Solution
    </span>
  </a>
  
    <nav class="md-nav" aria-label="6. The Complete Redirect-Based Security Solution">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      Overview
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-1-preserve-existing-proofpoint-scl-rule" class="md-nav__link">
    <span class="md-ellipsis">
      Step 1: Preserve Existing ProofPoint SCL Rule
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-2-create-the-redirect-infrastructure" class="md-nav__link">
    <span class="md-ellipsis">
      Step 2: Create the Redirect Infrastructure
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-3-create-application-server-exception-rule" class="md-nav__link">
    <span class="md-ellipsis">
      Step 3: Create Application Server Exception Rule
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-4-create-the-main-bypass-redirect-rule" class="md-nav__link">
    <span class="md-ellipsis">
      Step 4: Create the Main Bypass Redirect Rule
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rule-processing-flow" class="md-nav__link">
    <span class="md-ellipsis">
      Rule Processing Flow
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#loop-prevention-mechanisms" class="md-nav__link">
    <span class="md-ellipsis">
      Loop Prevention Mechanisms
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-why-the-redirect-approach-is-superior" class="md-nav__link">
    <span class="md-ellipsis">
      7. Why the Redirect Approach is Superior
    </span>
  </a>
  
    <nav class="md-nav" aria-label="7. Why the Redirect Approach is Superior">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#comparison-quarantine-vs-redirect" class="md-nav__link">
    <span class="md-ellipsis">
      Comparison: Quarantine vs Redirect
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#business-benefits-of-redirect-approach" class="md-nav__link">
    <span class="md-ellipsis">
      Business Benefits of Redirect Approach
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#security-benefits" class="md-nav__link">
    <span class="md-ellipsis">
      Security Benefits
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#8-implementation-steps-and-best-practices" class="md-nav__link">
    <span class="md-ellipsis">
      8. Implementation Steps and Best Practices
    </span>
  </a>
  
    <nav class="md-nav" aria-label="8. Implementation Steps and Best Practices">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pre-implementation-checklist" class="md-nav__link">
    <span class="md-ellipsis">
      Pre-Implementation Checklist
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#implementation-order" class="md-nav__link">
    <span class="md-ellipsis">
      Implementation Order
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#post-implementation-monitoring" class="md-nav__link">
    <span class="md-ellipsis">
      Post-Implementation Monitoring
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maintenance-commands" class="md-nav__link">
    <span class="md-ellipsis">
      Maintenance Commands
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#9-troubleshooting-common-issues" class="md-nav__link">
    <span class="md-ellipsis">
      9. Troubleshooting Common Issues
    </span>
  </a>
  
    <nav class="md-nav" aria-label="9. Troubleshooting Common Issues">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#issue-connector-shows-validation-failed" class="md-nav__link">
    <span class="md-ellipsis">
      Issue: Connector Shows "Validation Failed"
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#issue-meeting-forwards-still-being-caught" class="md-nav__link">
    <span class="md-ellipsis">
      Issue: Meeting Forwards Still Being Caught
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#issue-legitimate-partners-being-redirected" class="md-nav__link">
    <span class="md-ellipsis">
      Issue: Legitimate Partners Being Redirected
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#10-advanced-configurations" class="md-nav__link">
    <span class="md-ellipsis">
      10. Advanced Configurations
    </span>
  </a>
  
    <nav class="md-nav" aria-label="10. Advanced Configurations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#adding-regional-proofpoint-ips" class="md-nav__link">
    <span class="md-ellipsis">
      Adding Regional ProofPoint IPs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#custom-reporting" class="md-nav__link">
    <span class="md-ellipsis">
      Custom Reporting
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#11-security-considerations-and-best-practices" class="md-nav__link">
    <span class="md-ellipsis">
      11. Security Considerations and Best Practices
    </span>
  </a>
  
    <nav class="md-nav" aria-label="11. Security Considerations and Best Practices">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#regular-review-tasks" class="md-nav__link">
    <span class="md-ellipsis">
      Regular Review Tasks
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#security-hardening" class="md-nav__link">
    <span class="md-ellipsis">
      Security Hardening
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#compliance-considerations" class="md-nav__link">
    <span class="md-ellipsis">
      Compliance Considerations
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#12-summary-and-lessons-learned" class="md-nav__link">
    <span class="md-ellipsis">
      12. Summary and Lessons Learned
    </span>
  </a>
  
    <nav class="md-nav" aria-label="12. Summary and Lessons Learned">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#key-takeaways" class="md-nav__link">
    <span class="md-ellipsis">
      Key Takeaways
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-final-architecture" class="md-nav__link">
    <span class="md-ellipsis">
      The Final Architecture
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#future-considerations" class="md-nav__link">
    <span class="md-ellipsis">
      Future Considerations
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#13-additional-resources" class="md-nav__link">
    <span class="md-ellipsis">
      13. Additional Resources
    </span>
  </a>
  
    <nav class="md-nav" aria-label="13. Additional Resources">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#useful-powershell-commands" class="md-nav__link">
    <span class="md-ellipsis">
      Useful PowerShell Commands
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dns-verification-commands" class="md-nav__link">
    <span class="md-ellipsis">
      DNS Verification Commands
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    <span class="md-ellipsis">
      Introduction
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#1-email-flow-architecture" class="md-nav__link">
    <span class="md-ellipsis">
      1. Email Flow Architecture
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1. Email Flow Architecture">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-bypass-problem-explained" class="md-nav__link">
    <span class="md-ellipsis">
      The Bypass Problem Explained
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-spf-dkim-and-dmarc-explained" class="md-nav__link">
    <span class="md-ellipsis">
      2. SPF, DKIM, and DMARC Explained
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2. SPF, DKIM, and DMARC Explained">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#spf-sender-policy-framework" class="md-nav__link">
    <span class="md-ellipsis">
      SPF (Sender Policy Framework)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dkim-domainkeys-identified-mail" class="md-nav__link">
    <span class="md-ellipsis">
      DKIM (DomainKeys Identified Mail)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dmarc-domain-based-message-authentication-reporting-and-conformance" class="md-nav__link">
    <span class="md-ellipsis">
      DMARC (Domain-based Message Authentication, Reporting, and Conformance)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-the-problem-spoofing-despite-dmarc-quarantine" class="md-nav__link">
    <span class="md-ellipsis">
      3. The Problem: Spoofing Despite DMARC Quarantine
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3. The Problem: Spoofing Despite DMARC Quarantine">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#why-this-happens" class="md-nav__link">
    <span class="md-ellipsis">
      Why This Happens
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#real-world-example-teams-meeting-forward-issue" class="md-nav__link">
    <span class="md-ellipsis">
      Real-World Example: Teams Meeting Forward Issue
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-evolution-from-quarantine-to-redirect-approach" class="md-nav__link">
    <span class="md-ellipsis">
      4. Evolution from Quarantine to Redirect Approach
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4. Evolution from Quarantine to Redirect Approach">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#initial-quarantine-approach-problematic" class="md-nav__link">
    <span class="md-ellipsis">
      Initial Quarantine Approach (Problematic)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#problems-with-the-quarantine-approach" class="md-nav__link">
    <span class="md-ellipsis">
      Problems with the Quarantine Approach
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-better-solution-redirect-approach" class="md-nav__link">
    <span class="md-ellipsis">
      The Better Solution: Redirect Approach
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-allowing-legitimate-internal-applications" class="md-nav__link">
    <span class="md-ellipsis">
      5. Allowing Legitimate Internal Applications
    </span>
  </a>
  
    <nav class="md-nav" aria-label="5. Allowing Legitimate Internal Applications">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#step-by-step-creating-a-connector-in-o365" class="md-nav__link">
    <span class="md-ellipsis">
      Step-by-Step: Creating a Connector in O365
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-the-complete-redirect-based-security-solution" class="md-nav__link">
    <span class="md-ellipsis">
      6. The Complete Redirect-Based Security Solution
    </span>
  </a>
  
    <nav class="md-nav" aria-label="6. The Complete Redirect-Based Security Solution">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      Overview
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-1-preserve-existing-proofpoint-scl-rule" class="md-nav__link">
    <span class="md-ellipsis">
      Step 1: Preserve Existing ProofPoint SCL Rule
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-2-create-the-redirect-infrastructure" class="md-nav__link">
    <span class="md-ellipsis">
      Step 2: Create the Redirect Infrastructure
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-3-create-application-server-exception-rule" class="md-nav__link">
    <span class="md-ellipsis">
      Step 3: Create Application Server Exception Rule
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-4-create-the-main-bypass-redirect-rule" class="md-nav__link">
    <span class="md-ellipsis">
      Step 4: Create the Main Bypass Redirect Rule
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rule-processing-flow" class="md-nav__link">
    <span class="md-ellipsis">
      Rule Processing Flow
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#loop-prevention-mechanisms" class="md-nav__link">
    <span class="md-ellipsis">
      Loop Prevention Mechanisms
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-why-the-redirect-approach-is-superior" class="md-nav__link">
    <span class="md-ellipsis">
      7. Why the Redirect Approach is Superior
    </span>
  </a>
  
    <nav class="md-nav" aria-label="7. Why the Redirect Approach is Superior">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#comparison-quarantine-vs-redirect" class="md-nav__link">
    <span class="md-ellipsis">
      Comparison: Quarantine vs Redirect
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#business-benefits-of-redirect-approach" class="md-nav__link">
    <span class="md-ellipsis">
      Business Benefits of Redirect Approach
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#security-benefits" class="md-nav__link">
    <span class="md-ellipsis">
      Security Benefits
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#8-implementation-steps-and-best-practices" class="md-nav__link">
    <span class="md-ellipsis">
      8. Implementation Steps and Best Practices
    </span>
  </a>
  
    <nav class="md-nav" aria-label="8. Implementation Steps and Best Practices">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pre-implementation-checklist" class="md-nav__link">
    <span class="md-ellipsis">
      Pre-Implementation Checklist
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#implementation-order" class="md-nav__link">
    <span class="md-ellipsis">
      Implementation Order
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#post-implementation-monitoring" class="md-nav__link">
    <span class="md-ellipsis">
      Post-Implementation Monitoring
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maintenance-commands" class="md-nav__link">
    <span class="md-ellipsis">
      Maintenance Commands
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#9-troubleshooting-common-issues" class="md-nav__link">
    <span class="md-ellipsis">
      9. Troubleshooting Common Issues
    </span>
  </a>
  
    <nav class="md-nav" aria-label="9. Troubleshooting Common Issues">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#issue-connector-shows-validation-failed" class="md-nav__link">
    <span class="md-ellipsis">
      Issue: Connector Shows "Validation Failed"
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#issue-meeting-forwards-still-being-caught" class="md-nav__link">
    <span class="md-ellipsis">
      Issue: Meeting Forwards Still Being Caught
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#issue-legitimate-partners-being-redirected" class="md-nav__link">
    <span class="md-ellipsis">
      Issue: Legitimate Partners Being Redirected
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#10-advanced-configurations" class="md-nav__link">
    <span class="md-ellipsis">
      10. Advanced Configurations
    </span>
  </a>
  
    <nav class="md-nav" aria-label="10. Advanced Configurations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#adding-regional-proofpoint-ips" class="md-nav__link">
    <span class="md-ellipsis">
      Adding Regional ProofPoint IPs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#custom-reporting" class="md-nav__link">
    <span class="md-ellipsis">
      Custom Reporting
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#11-security-considerations-and-best-practices" class="md-nav__link">
    <span class="md-ellipsis">
      11. Security Considerations and Best Practices
    </span>
  </a>
  
    <nav class="md-nav" aria-label="11. Security Considerations and Best Practices">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#regular-review-tasks" class="md-nav__link">
    <span class="md-ellipsis">
      Regular Review Tasks
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#security-hardening" class="md-nav__link">
    <span class="md-ellipsis">
      Security Hardening
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#compliance-considerations" class="md-nav__link">
    <span class="md-ellipsis">
      Compliance Considerations
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#12-summary-and-lessons-learned" class="md-nav__link">
    <span class="md-ellipsis">
      12. Summary and Lessons Learned
    </span>
  </a>
  
    <nav class="md-nav" aria-label="12. Summary and Lessons Learned">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#key-takeaways" class="md-nav__link">
    <span class="md-ellipsis">
      Key Takeaways
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-final-architecture" class="md-nav__link">
    <span class="md-ellipsis">
      The Final Architecture
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#future-considerations" class="md-nav__link">
    <span class="md-ellipsis">
      Future Considerations
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#13-additional-resources" class="md-nav__link">
    <span class="md-ellipsis">
      13. Additional Resources
    </span>
  </a>
  
    <nav class="md-nav" aria-label="13. Additional Resources">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#useful-powershell-commands" class="md-nav__link">
    <span class="md-ellipsis">
      Useful PowerShell Commands
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dns-verification-commands" class="md-nav__link">
    <span class="md-ellipsis">
      DNS Verification Commands
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="understanding-spf-dkim-and-dmarc-in-o365-with-proofpoint-preventing-spoofing-and-bypass-attacks">Understanding SPF, DKIM, and DMARC in O365 with Proofpoint: Preventing Spoofing and Bypass Attacks</h1>
<h2 id="introduction">Introduction</h2>
<p>Email security is a critical aspect of any organization's IT infrastructure. This article explains the basics of SPF, DKIM, and DMARC, and details a real-world scenario involving Office 365 (O365) and Proofpoint, where attackers were able to bypass protections and how to mitigate such risks.</p>
<p>After implementing traditional quarantine approaches, we discovered significant operational challenges that led us to adopt a more sophisticated <strong>redirect-based solution</strong> that maintains business continuity while providing superior security protection.</p>
<hr />
<h2 id="1-email-flow-architecture">1. Email Flow Architecture</h2>
<ul>
<li><strong>Internal Emails:</strong> Sent from one user to another within the organization, these do <strong>not</strong> traverse Proofpoint.</li>
<li><strong>Outbound External Emails:</strong> Sent from O365 to Proofpoint, then to external recipients.</li>
<li><strong>Inbound External Emails:</strong> Received by Proofpoint, then relayed to O365, and finally delivered to users.</li>
</ul>
<blockquote>
<p><strong>Note:</strong> Even after configuring MX records to point only to Proofpoint (e.g., <code>mx1-us1.ppe-hosted.com</code> with IPs <code>148.163.129.50</code> and <code>67.231.154.162</code>), attackers may still find ways to bypass these controls.</p>
</blockquote>
<h3 id="the-bypass-problem-explained">The Bypass Problem Explained</h3>
<p>Attackers can research your organization's <code>.onmicrosoft.com</code> domain and send emails directly to Microsoft's EOP servers, completely bypassing your ProofPoint security stack. This happens because:</p>
<ol>
<li><strong>Discovery of .onmicrosoft.com domains</strong>: Attackers use tools like MXtoolbox to find your <code>companyname.onmicrosoft.com</code> domain</li>
<li><strong>Direct delivery to Microsoft</strong>: They send emails directly to <code>mail.protection.outlook.com</code> servers</li>
<li><strong>Bypass your MX records</strong>: Since they're not using normal MX record lookup, your ProofPoint gateway never sees these emails</li>
</ol>
<hr />
<h2 id="2-spf-dkim-and-dmarc-explained">2. SPF, DKIM, and DMARC Explained</h2>
<h3 id="spf-sender-policy-framework">SPF (Sender Policy Framework)</h3>
<ul>
<li><strong>Purpose:</strong> Specifies which mail servers are authorized to send email for your domain.</li>
<li><strong>How to Check:</strong>
  <div class="highlight"><pre><span></span><code>dig<span class="w"> </span>+short<span class="w"> </span>TXT<span class="w"> </span>munishsethi.com
dig<span class="w"> </span>+short<span class="w"> </span>TXT<span class="w"> </span>_spf.munishsethi.com
</code></pre></div></li>
<li><strong>Example Record:</strong>
  <div class="highlight"><pre><span></span><code>v=spf1 include:spf.protection.outlook.com include:spf.proofpoint.com -all
</code></pre></div></li>
</ul>
<h3 id="dkim-domainkeys-identified-mail">DKIM (DomainKeys Identified Mail)</h3>
<ul>
<li><strong>Purpose:</strong> Uses cryptographic signatures to verify that an email was sent by an authorized server and was not altered.</li>
<li><strong>How to Check:</strong>
  <div class="highlight"><pre><span></span><code>dig<span class="w"> </span>+short<span class="w"> </span>TXT<span class="w"> </span>selector1._domainkey.munishsethi.com
</code></pre></div></li>
<li><strong>Example Record:</strong>
  <div class="highlight"><pre><span></span><code>v=DKIM1; k=rsa; p=...public-key...
</code></pre></div></li>
</ul>
<h3 id="dmarc-domain-based-message-authentication-reporting-and-conformance">DMARC (Domain-based Message Authentication, Reporting, and Conformance)</h3>
<ul>
<li><strong>Purpose:</strong> Tells receiving servers what to do if SPF or DKIM checks fail.</li>
<li><strong>How to Check:</strong>
  <div class="highlight"><pre><span></span><code>dig<span class="w"> </span>+short<span class="w"> </span>TXT<span class="w"> </span>_dmarc.munishsethi.com
</code></pre></div></li>
<li><strong>Example Record:</strong>
  <div class="highlight"><pre><span></span><code>v=DMARC1; p=quarantine; rua=mailto:dmarc-reports@munishsethi.com
</code></pre></div></li>
<li><strong>Policy Options:</strong></li>
<li><code>none</code>: Take no action, just report.</li>
<li><code>quarantine</code>: Treat as suspicious (e.g., send to spam/quarantine).</li>
<li><code>reject</code>: Reject the message outright.</li>
</ul>
<hr />
<h2 id="3-the-problem-spoofing-despite-dmarc-quarantine">3. The Problem: Spoofing Despite DMARC Quarantine</h2>
<p>Even after setting the MX records to Proofpoint and configuring DMARC with <code>p=quarantine</code>, spoofed emails were still being delivered. Investigation revealed that attackers were sending emails directly to the Microsoft EOP (Exchange Online Protection) endpoint (e.g., <code>SJ1PEPF000023D6.mail.protection.outlook.com</code>), bypassing the MX record lookup. Microsoft EOP sometimes relayed these messages to users if the spam score (SCL) was low, even if DMARC failed.</p>
<h3 id="why-this-happens">Why This Happens</h3>
<ul>
<li>Microsoft EOP may not always quarantine emails with failed DMARC if the SCL is low.</li>
<li>Attackers can send directly to O365 endpoints, bypassing Proofpoint.</li>
</ul>
<h3 id="real-world-example-teams-meeting-forward-issue">Real-World Example: Teams Meeting Forward Issue</h3>
<p>During our implementation, we encountered a specific scenario that highlighted the complexity of modern email security:</p>
<p><strong>The Scenario</strong>: A user received a Teams calendar meeting invite from an external sender (<code>rmay@dmainc.com</code>). When this user forwarded the meeting to internal colleagues, the forwarded meeting was being quarantined by our security rules.</p>
<p><strong>The Problem</strong>: The forwarded email had:
- <code>From: "May, Rico" &lt;rmay@dmainc.com&gt;</code> (external domain)
- <code>Sender: Manimaran Chokkappa &lt;Manimaran.Chokkappa.ext@yourcompany.com&gt;</code> (internal)
- <code>X-MS-Exchange-MeetingForward-Message: Forward</code> (indicating internal forward)</p>
<p>This legitimate internal forward was being treated as an external threat because Exchange preserves the original "From" address while adding internal sender information.</p>
<hr />
<h2 id="4-evolution-from-quarantine-to-redirect-approach">4. Evolution from Quarantine to Redirect Approach</h2>
<h3 id="initial-quarantine-approach-problematic">Initial Quarantine Approach (Problematic)</h3>
<p>Our first attempt used a broad quarantine rule:</p>
<div class="highlight"><pre><span></span><code><span class="nb">New-TransportRule</span> <span class="n">-Name</span> <span class="s2">&quot;Quarantine external spoof bypass Proofpoint&quot;</span> <span class="p">`</span>
  <span class="n">-FromScope</span> <span class="n">NotInOrganization</span> <span class="p">`</span>
  <span class="n">-SetAuditSeverity</span> <span class="n">High</span> <span class="p">`</span>
  <span class="n">-Quarantine</span> <span class="nv">$true</span> <span class="p">`</span>
  <span class="n">-ExceptIfSenderDomainIs</span> <span class="p">@(</span><span class="s2">&quot;skype.voicemail.microsoft.com&quot;</span><span class="p">,</span> <span class="s2">&quot;microsoft.com&quot;</span><span class="p">)</span> <span class="p">`</span>
  <span class="n">-ExceptIfHeaderMatchesMessageHeader</span> <span class="s2">&quot;X-PPE-TRUSTED&quot;</span> <span class="n">-ExceptIfHeaderMatchesPatterns</span> <span class="s2">&quot;[\s\S]*&quot;</span> <span class="p">`</span>
  <span class="n">-ExceptIfHeaderContainsMessageHeader</span> <span class="s2">&quot;X-MS-Exchange-MeetingForward-Message&quot;</span> <span class="n">-ExceptIfHeaderContainsWords</span> <span class="s2">&quot;Forward&quot;</span>
</code></pre></div>
<h3 id="problems-with-the-quarantine-approach">Problems with the Quarantine Approach</h3>
<ol>
<li><strong>Overly Broad</strong>: Quarantined ALL external email except specific exceptions</li>
<li><strong>Operational Impact</strong>: </li>
<li>Customer communications blocked</li>
<li>Partner emails quarantined</li>
<li>Legitimate business correspondence interrupted</li>
<li>Meeting forwards and internal operations affected</li>
<li><strong>Administrative Overhead</strong>: IT overwhelmed with quarantine release requests</li>
<li><strong>Business Disruption</strong>: Users couldn't receive important external communications</li>
</ol>
<h3 id="the-better-solution-redirect-approach">The Better Solution: Redirect Approach</h3>
<p>After experiencing these operational challenges, we developed a <strong>redirect-based solution</strong> that:</p>
<ul>
<li><strong>Maintains mail flow</strong> while ensuring security</li>
<li><strong>Forces suspicious emails</strong> back through the proper security stack</li>
<li><strong>Reduces false positives</strong> significantly</li>
<li><strong>Preserves business continuity</strong></li>
</ul>
<hr />
<h2 id="5-allowing-legitimate-internal-applications">5. Allowing Legitimate Internal Applications</h2>
<p>Some internal applications need to send emails (e.g., alerts, notifications) to both internal and external recipients. These are sent from trusted IP addresses and should be allowed.</p>
<h3 id="step-by-step-creating-a-connector-in-o365">Step-by-Step: Creating a Connector in O365</h3>
<ol>
<li><strong>Log in to the Microsoft 365 Admin Center</strong></li>
<li>Go to https://admin.exchange.microsoft.com</li>
<li>
<p>Use an account with Exchange admin permissions.</p>
</li>
<li>
<p><strong>Navigate to Mail Flow &gt; Connectors</strong></p>
</li>
<li>
<p>In the left pane, select <strong>Mail flow</strong> &gt; <strong>Connectors</strong>.</p>
</li>
<li>
<p><strong>Create a New Connector</strong></p>
</li>
<li>Click <strong>Add a connector</strong>.</li>
<li><strong>From:</strong> Your organization's email server</li>
<li><strong>To:</strong> Office 365</li>
<li>
<p>Click <strong>Next</strong>.</p>
</li>
<li>
<p><strong>Name and Describe the Connector</strong></p>
</li>
<li>Give the connector a meaningful name (e.g., "Internal App Relay").</li>
<li>
<p>Add a description for future reference.</p>
</li>
<li>
<p><strong>Specify Trusted IP Addresses</strong></p>
</li>
<li>Select "By verifying that the IP address of the sending server matches one of the following IP addresses..."</li>
<li>
<p>Enter the public IP addresses of your trusted internal applications/servers.</p>
</li>
<li>
<p><strong>Configure Security Restrictions</strong></p>
</li>
<li>
<p>Choose whether to require TLS, certificate, or other restrictions as needed.</p>
</li>
<li>
<p><strong>Review and Create</strong></p>
</li>
<li>
<p>Review your settings and click <strong>Create connector</strong>.</p>
</li>
<li>
<p><strong>Test the Connector</strong></p>
</li>
<li>Send a test email from your internal application to an internal and external recipient.</li>
<li>Check message headers in the recipient's mailbox to confirm successful delivery and correct routing.</li>
</ol>
<p><strong>Tip:</strong> Use the "Message Trace" feature in Exchange Admin Center to troubleshoot delivery issues.</p>
<hr />
<h2 id="6-the-complete-redirect-based-security-solution">6. The Complete Redirect-Based Security Solution</h2>
<h3 id="overview">Overview</h3>
<p>Our final solution consists of three coordinated components:</p>
<ol>
<li><strong>ProofPoint SCL Rule</strong> (Highest Priority - Keep existing)</li>
<li><strong>Azure/Application Server Allow Rule</strong> (Priority 2)</li>
<li><strong>Bypass Redirect Rule</strong> (Priority 3)</li>
</ol>
<h3 id="step-1-preserve-existing-proofpoint-scl-rule">Step 1: Preserve Existing ProofPoint SCL Rule</h3>
<p><strong>Keep your existing highest priority rule that your ProofPoint partner created:</strong></p>
<div class="highlight"><pre><span></span><code>Rule: ProofPoint SCL Trust Rule
Priority: 1 (Highest)
Conditions: sender ip addresses belong to ProofPoint ranges
Actions: Set the spam confidence level (SCL) to &#39;-1&#39;
</code></pre></div>
<p><strong>Why this is critical:</strong>
- SCL -1 = "Trusted sender" bypasses all EOP spam filtering
- Prevents EOP from re-scanning mail already processed by ProofPoint
- Ensures clean mail from ProofPoint isn't incorrectly blocked</p>
<h3 id="step-2-create-the-redirect-infrastructure">Step 2: Create the Redirect Infrastructure</h3>
<p><strong>Create the outbound connector for redirecting bypass attempts:</strong></p>
<div class="highlight"><pre><span></span><code><span class="c"># Connect to Exchange Online PowerShell</span>
<span class="nb">Connect-ExchangeOnline</span> <span class="n">-UserPrincipalName</span> <span class="p">&lt;</span><span class="n">your-admin-account</span><span class="p">&gt;</span>

<span class="c"># Create outbound connector for redirect functionality</span>
<span class="nb">New-OutboundConnector</span> <span class="n">-Name</span> <span class="s1">&#39;Redirect Bypass to MX&#39;</span> <span class="p">`</span>
  <span class="n">-ConnectorType</span> <span class="s1">&#39;Partner&#39;</span> <span class="p">`</span>
  <span class="n">-UseMxRecord</span><span class="p">:</span><span class="nv">$true</span> <span class="p">`</span>
  <span class="n">-IsTransportRuleScoped</span><span class="p">:</span><span class="nv">$True</span>
</code></pre></div>
<p><strong>Explanation:</strong>
- <code>UseMxRecord:$true</code>: Forces mail back through proper MX record lookup
- <code>IsTransportRuleScoped:$True</code>: Only activates when triggered by transport rule
- This connector will route suspicious mail back to ProofPoint for proper processing</p>
<h3 id="step-3-create-application-server-exception-rule">Step 3: Create Application Server Exception Rule</h3>
<div class="highlight"><pre><span></span><code><span class="c"># Rule to allow legitimate application servers (Azure, Physical Company Locations etc.)</span>
<span class="nb">New-TransportRule</span> <span class="n">-Name</span> <span class="s1">&#39;Allow Company Servers Direct Delivery&#39;</span> <span class="p">`</span>
  <span class="n">-FromScope</span> <span class="n">NotInOrganization</span> <span class="p">`</span>
  <span class="n">-RecipientDomainIs</span> <span class="s2">&quot;yourdomain.com&quot;</span> <span class="p">`</span>
  <span class="n">-SenderIpRanges</span> <span class="p">@(</span>
    <span class="c"># Azure/Application Server IPs</span>
    <span class="s2">&quot;XXX.XX.XX.XX/32&quot;</span><span class="p">,</span><span class="s2">&quot;YY.YY.YYY.YYY/32&quot;</span>
  <span class="p">)</span> <span class="p">`</span>
  <span class="n">-SetAuditSeverity</span> <span class="n">Low</span> <span class="p">`</span>
  <span class="n">-StopRuleProcessing</span> <span class="nv">$true</span>
</code></pre></div>
<p><strong>Explanation:</strong>
- <strong>Purpose</strong>: Allows legitimate application servers to deliver directly to O365
- <strong>StopRuleProcessing</strong>: If this rule matches, don't process the redirect rule
- <strong>Easy Maintenance</strong>: Simple to update when adding new Azure regions or application servers</p>
<h3 id="step-4-create-the-main-bypass-redirect-rule">Step 4: Create the Main Bypass Redirect Rule</h3>
<div class="highlight"><pre><span></span><code><span class="c"># Main rule to redirect ProofPoint bypass attempts</span>
<span class="nb">New-TransportRule</span> <span class="n">-Name</span> <span class="s1">&#39;Redirect Direct Delivery to MX&#39;</span> <span class="p">`</span>
  <span class="n">-FromScope</span> <span class="n">NotInOrganization</span> <span class="p">`</span>
  <span class="n">-RecipientDomainIs</span> <span class="s2">&quot;yourdomain.com&quot;</span> <span class="p">`</span>
  <span class="n">-ExceptIfSenderIpRanges</span> <span class="p">@(</span>
    <span class="c"># ProofPoint IP Ranges (Static - rarely change)</span>
    <span class="s2">&quot;67.231.149.0/24&quot;</span><span class="p">,</span><span class="s2">&quot;67.231.148.0/24&quot;</span><span class="p">,</span><span class="s2">&quot;67.231.147.0/24&quot;</span><span class="p">,</span>
    <span class="s2">&quot;67.231.146.0/24&quot;</span><span class="p">,</span><span class="s2">&quot;67.231.145.0/24&quot;</span><span class="p">,</span><span class="s2">&quot;67.231.144.0/24&quot;</span><span class="p">,</span>
    <span class="s2">&quot;67.231.156.0/24&quot;</span><span class="p">,</span><span class="s2">&quot;67.231.155.0/24&quot;</span><span class="p">,</span><span class="s2">&quot;67.231.154.0/24&quot;</span><span class="p">,</span>
    <span class="s2">&quot;67.231.153.0/24&quot;</span><span class="p">,</span><span class="s2">&quot;67.231.152.0/24&quot;</span><span class="p">,</span><span class="s2">&quot;148.163.159.0/24&quot;</span><span class="p">,</span>
    <span class="s2">&quot;148.163.158.0/24&quot;</span><span class="p">,</span><span class="s2">&quot;148.163.157.0/24&quot;</span><span class="p">,</span><span class="s2">&quot;148.163.156.0/24&quot;</span><span class="p">,</span>
    <span class="s2">&quot;148.163.155.0/24&quot;</span><span class="p">,</span><span class="s2">&quot;148.163.154.0/24&quot;</span><span class="p">,</span><span class="s2">&quot;148.163.153.0/24&quot;</span><span class="p">,</span>
    <span class="s2">&quot;148.163.152.0/24&quot;</span><span class="p">,</span><span class="s2">&quot;148.163.151.0/24&quot;</span><span class="p">,</span><span class="s2">&quot;148.163.150.0/24&quot;</span><span class="p">,</span>
    <span class="s2">&quot;148.163.149.0/24&quot;</span><span class="p">,</span><span class="s2">&quot;148.163.148.0/24&quot;</span><span class="p">,</span><span class="s2">&quot;148.163.147.0/24&quot;</span><span class="p">,</span>
    <span class="s2">&quot;148.163.146.0/24&quot;</span><span class="p">,</span><span class="s2">&quot;148.163.145.0/24&quot;</span><span class="p">,</span><span class="s2">&quot;148.163.144.0/24&quot;</span><span class="p">,</span>
    <span class="s2">&quot;148.163.143.0/24&quot;</span><span class="p">,</span><span class="s2">&quot;148.163.142.0/24&quot;</span><span class="p">,</span><span class="s2">&quot;148.163.141.0/24&quot;</span><span class="p">,</span>
    <span class="s2">&quot;148.163.140.0/24&quot;</span><span class="p">,</span><span class="s2">&quot;148.163.139.0/24&quot;</span><span class="p">,</span><span class="s2">&quot;148.163.138.0/24&quot;</span><span class="p">,</span>
    <span class="s2">&quot;148.163.137.0/24&quot;</span><span class="p">,</span><span class="s2">&quot;148.163.136.0/24&quot;</span><span class="p">,</span><span class="s2">&quot;148.163.135.0/24&quot;</span><span class="p">,</span>
    <span class="s2">&quot;148.163.134.0/24&quot;</span><span class="p">,</span><span class="s2">&quot;148.163.133.0/24&quot;</span><span class="p">,</span><span class="s2">&quot;148.163.132.0/24&quot;</span><span class="p">,</span>
    <span class="s2">&quot;148.163.131.0/24&quot;</span><span class="p">,</span><span class="s2">&quot;148.163.130.0/24&quot;</span><span class="p">,</span><span class="s2">&quot;148.163.129.0/24&quot;</span><span class="p">,</span>
    <span class="s2">&quot;148.163.128.0/24&quot;</span>
  <span class="p">)</span> <span class="p">`</span>
  <span class="n">-ExceptIfHeaderMatchesMessageHeader</span> <span class="s2">&quot;X-PPE-TRUSTED&quot;</span> <span class="p">`</span>
  <span class="n">-ExceptIfHeaderMatchesPatterns</span> <span class="s2">&quot;[\s\S]*&quot;</span> <span class="p">`</span>
  <span class="n">-SetAuditSeverity</span> <span class="n">Low</span> <span class="p">`</span>
  <span class="n">-RouteMessageOutboundConnector</span> <span class="s1">&#39;Redirect Bypass to MX&#39;</span>
</code></pre></div>
<p><strong>Explanation:</strong>
- <strong>Target</strong>: External emails to your domain that didn't come through ProofPoint
- <strong>Exceptions</strong>: 
  - ProofPoint IP ranges (legitimate mail flow)
  - X-PPE-TRUSTED header (already processed by ProofPoint)
- <strong>Action</strong>: Route back through MX records (to ProofPoint) instead of quarantining
- <strong>Result</strong>: Suspicious mail gets processed by your security stack before delivery</p>
<h3 id="rule-processing-flow">Rule Processing Flow</h3>
<div class="highlight"><pre><span></span><code>Email arrives at O365 EOP
    ↓
Priority 1: ProofPoint SCL Rule
├── From ProofPoint IP? → Set SCL -1 (Trusted) → Deliver
    ↓
Priority 2: Azure Application Allow Rule  
├── From Azure/App IP? → Allow Direct Delivery → Stop Processing
    ↓
Priority 3: Bypass Redirect Rule
├── From external &amp; not ProofPoint? → Redirect to MX (ProofPoint)
├── From ProofPoint or has X-PPE-TRUSTED? → Allow delivery
    ↓
Normal delivery continues
</code></pre></div>
<h3 id="loop-prevention-mechanisms">Loop Prevention Mechanisms</h3>
<p><strong>How we prevent mail loops:</strong></p>
<ol>
<li><strong>IP-based Recognition</strong>: When ProofPoint processes redirected mail and delivers it back, it comes from ProofPoint IPs</li>
<li><strong>Header-based Recognition</strong>: ProofPoint adds X-PPE-TRUSTED header to processed mail</li>
<li><strong>Exception Logic</strong>: Both trigger exceptions in the redirect rule, preventing re-redirect</li>
</ol>
<p><strong>Example Flow:</strong>
<div class="highlight"><pre><span></span><code>Attacker sends direct to EOP → Redirect Rule triggers → Mail sent to ProofPoint
    ↓
ProofPoint processes mail → Delivers from ProofPoint IP with X-PPE-TRUSTED header
    ↓
Redirect rule exceptions apply → Mail delivered normally (no loop)
</code></pre></div></p>
<hr />
<h2 id="7-why-the-redirect-approach-is-superior">7. Why the Redirect Approach is Superior</h2>
<h3 id="comparison-quarantine-vs-redirect">Comparison: Quarantine vs Redirect</h3>
<table>
<thead>
<tr>
<th>Aspect</th>
<th>Quarantine Approach</th>
<th>Redirect Approach</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Security</strong></td>
<td>High (blocks everything)</td>
<td>High (forces through security stack)</td>
</tr>
<tr>
<td><strong>False Positives</strong></td>
<td>Very High</td>
<td>Low</td>
</tr>
<tr>
<td><strong>Business Impact</strong></td>
<td>Severe disruption</td>
<td>Minimal disruption</td>
</tr>
<tr>
<td><strong>Maintenance</strong></td>
<td>High (constant release requests)</td>
<td>Low (automated processing)</td>
</tr>
<tr>
<td><strong>User Experience</strong></td>
<td>Poor (missing emails)</td>
<td>Good (delayed but delivered)</td>
</tr>
<tr>
<td><strong>IT Overhead</strong></td>
<td>Very High</td>
<td>Low</td>
</tr>
</tbody>
</table>
<h3 id="business-benefits-of-redirect-approach">Business Benefits of Redirect Approach</h3>
<ol>
<li><strong>Maintains Business Continuity</strong>: Legitimate emails still get delivered after processing</li>
<li><strong>Reduces Help Desk Load</strong>: No quarantine release requests for legitimate mail</li>
<li><strong>Provides Complete Protection</strong>: All email goes through your security stack</li>
<li><strong>Enables Monitoring</strong>: Can track exactly how much bypass traffic you're getting</li>
<li><strong>Flexible</strong>: Easy to add exceptions for legitimate sources</li>
</ol>
<h3 id="security-benefits">Security Benefits</h3>
<ol>
<li><strong>Zero Bypass</strong>: All external email is forced through ProofPoint</li>
<li><strong>Comprehensive Coverage</strong>: Catches all bypass attempts, not just obvious spoofs</li>
<li><strong>Maintains Defenses</strong>: Your security stack processes everything</li>
<li><strong>Audit Trail</strong>: Complete visibility into redirect activity</li>
</ol>
<hr />
<h2 id="8-implementation-steps-and-best-practices">8. Implementation Steps and Best Practices</h2>
<h3 id="pre-implementation-checklist">Pre-Implementation Checklist</h3>
<ol>
<li>
<p><strong>Document Current State</strong>:
   <div class="highlight"><pre><span></span><code><span class="c"># Get current transport rules</span>
<span class="nb">Get-TransportRule</span> <span class="p">|</span> <span class="nb">Select-Object</span> <span class="n">Name</span><span class="p">,</span> <span class="n">Priority</span><span class="p">,</span> <span class="n">State</span>

<span class="c"># Get current connectors  </span>
<span class="nb">Get-InboundConnector</span> <span class="p">|</span> <span class="nb">Select-Object</span> <span class="n">Name</span><span class="p">,</span> <span class="n">SenderIPAddresses</span>
<span class="nb">Get-OutboundConnector</span> <span class="p">|</span> <span class="nb">Select-Object</span> <span class="n">Name</span><span class="p">,</span> <span class="n">SmartHosts</span>
</code></pre></div></p>
</li>
<li>
<p><strong>Test Environment</strong>: If possible, test in a development tenant first</p>
</li>
<li>
<p><strong>Communication Plan</strong>: Inform users about potential short delays during initial processing</p>
</li>
</ol>
<h3 id="implementation-order">Implementation Order</h3>
<ol>
<li><strong>Create redirect connector</strong> (doesn't affect mail flow until rules are created)</li>
<li><strong>Create Azure/Application allow rule</strong> (prevents legitimate app mail from being redirected)  </li>
<li><strong>Create bypass redirect rule</strong> (starts catching bypass attempts)</li>
<li><strong>Monitor and adjust</strong> as needed</li>
</ol>
<h3 id="post-implementation-monitoring">Post-Implementation Monitoring</h3>
<ol>
<li>
<p><strong>Check Rule Reports</strong>:
   <div class="highlight"><pre><span></span><code><span class="c"># Check rule execution statistics</span>
<span class="nb">Get-TransportRule</span> <span class="s2">&quot;Redirect Direct Delivery to MX&quot;</span> <span class="p">|</span> <span class="nb">Get-TransportRuleReport</span>
</code></pre></div></p>
</li>
<li>
<p><strong>Monitor Message Trace</strong>: Look for emails being redirected and ensure they're delivered after processing</p>
</li>
<li>
<p><strong>Review Connector Validation</strong>: The redirect connector will show "Validation failed" - this is normal and expected</p>
</li>
</ol>
<h3 id="maintenance-commands">Maintenance Commands</h3>
<p><strong>Update Azure/Application IPs:</strong>
<div class="highlight"><pre><span></span><code><span class="nb">Set-TransportRule</span> <span class="n">-Identity</span> <span class="s1">&#39;Allow Azure Application Servers Direct Delivery&#39;</span> <span class="p">`</span>
  <span class="n">-SenderIpRanges</span> <span class="p">@(</span><span class="s2">&quot;NEW_IP_LIST_HERE&quot;</span><span class="p">)</span>
</code></pre></div></p>
<p><strong>Check Current Settings:</strong>
<div class="highlight"><pre><span></span><code><span class="nb">Get-TransportRule</span> <span class="s2">&quot;Allow Azure Application Servers Direct Delivery&quot;</span> <span class="p">|</span> 
  <span class="nb">Select-Object</span> <span class="n">SenderIpRanges</span>
</code></pre></div></p>
<hr />
<h2 id="9-troubleshooting-common-issues">9. Troubleshooting Common Issues</h2>
<h3 id="issue-connector-shows-validation-failed">Issue: Connector Shows "Validation Failed"</h3>
<p><strong>Symptom</strong>: The redirect connector shows validation failure in Exchange Admin Center</p>
<p><strong>Cause</strong>: Normal behavior - ProofPoint has security restrictions preventing test connections</p>
<p><strong>Resolution</strong>: This is expected and the connector will work when triggered by transport rules</p>
<h3 id="issue-meeting-forwards-still-being-caught">Issue: Meeting Forwards Still Being Caught</h3>
<p><strong>Symptom</strong>: Internal meeting forwards are being redirected</p>
<p><strong>Analysis</strong>: Check message headers for:
- <code>X-MS-Exchange-MeetingForward-Message: Forward</code>
- Internal sender information</p>
<p><strong>Resolution</strong>: These should not trigger the redirect rule due to <code>FromScope NotInOrganization</code>, but if they do, add specific exceptions</p>
<h3 id="issue-legitimate-partners-being-redirected">Issue: Legitimate Partners Being Redirected</h3>
<p><strong>Symptom</strong>: Known good partners' emails are being redirected</p>
<p><strong>Analysis</strong>: Verify if they're sending directly to EOP instead of through normal MX lookup</p>
<p><strong>Resolution</strong>: Add their IP ranges to the exception list or ask them to use proper MX record delivery</p>
<hr />
<h2 id="10-advanced-configurations">10. Advanced Configurations</h2>
<h3 id="adding-regional-proofpoint-ips">Adding Regional ProofPoint IPs</h3>
<p>If your organization expands to new regions with different ProofPoint IPs:</p>
<div class="highlight"><pre><span></span><code><span class="c"># Get current ProofPoint IPs</span>
<span class="nv">$currentRule</span> <span class="p">=</span> <span class="nb">Get-TransportRule</span> <span class="s2">&quot;Redirect Direct Delivery to MX&quot;</span>
<span class="nv">$currentIPs</span> <span class="p">=</span> <span class="nv">$currentRule</span><span class="p">.</span><span class="n">ExceptIfSenderIpRanges</span>

<span class="c"># Add new regional IPs</span>
<span class="nv">$newIPs</span> <span class="p">=</span> <span class="nv">$currentIPs</span> <span class="p">+</span> <span class="p">@(</span><span class="s2">&quot;NEW_PROOFPOINT_RANGE_1&quot;</span><span class="p">,</span><span class="s2">&quot;NEW_PROOFPOINT_RANGE_2&quot;</span><span class="p">)</span>

<span class="c"># Update rule</span>
<span class="nb">Set-TransportRule</span> <span class="n">-Identity</span> <span class="s2">&quot;Redirect Direct Delivery to MX&quot;</span> <span class="n">-ExceptIfSenderIpRanges</span> <span class="nv">$newIPs</span>
</code></pre></div>
<h3 id="custom-reporting">Custom Reporting</h3>
<p>Create custom monitoring for redirect activity:</p>
<div class="highlight"><pre><span></span><code><span class="c"># Get message trace for redirected emails (last 7 days)</span>
<span class="nb">Get-MessageTrace</span> <span class="n">-StartDate</span> <span class="p">(</span><span class="nb">Get-Date</span><span class="p">).</span><span class="n">AddDays</span><span class="p">(-</span><span class="n">7</span><span class="p">)</span> <span class="n">-EndDate</span> <span class="p">(</span><span class="nb">Get-Date</span><span class="p">)</span> <span class="p">|</span>
  <span class="nb">Where-Object</span> <span class="p">{</span><span class="nv">$_</span><span class="p">.</span><span class="n">MessageTraceId</span> <span class="o">-like</span> <span class="s2">&quot;*Redirect*&quot;</span><span class="p">}</span> <span class="p">|</span>
  <span class="nb">Select-Object</span> <span class="n">Received</span><span class="p">,</span> <span class="n">SenderAddress</span><span class="p">,</span> <span class="n">RecipientAddress</span><span class="p">,</span> <span class="n">Status</span>
</code></pre></div>
<hr />
<h2 id="11-security-considerations-and-best-practices">11. Security Considerations and Best Practices</h2>
<h3 id="regular-review-tasks">Regular Review Tasks</h3>
<ol>
<li><strong>Monthly</strong>: Review transport rule reports for unusual activity</li>
<li><strong>Quarterly</strong>: Audit IP exception lists for accuracy</li>
<li><strong>Annually</strong>: Review overall email security architecture</li>
</ol>
<h3 id="security-hardening">Security Hardening</h3>
<ol>
<li><strong>Monitor Redirect Volume</strong>: Sudden increases may indicate attack campaigns</li>
<li><strong>Review Exception Lists</strong>: Ensure only legitimate IPs are excepted</li>
<li><strong>DMARC Policy Evolution</strong>: Move from <code>p=quarantine</code> to <code>p=reject</code> when confident</li>
</ol>
<h3 id="compliance-considerations">Compliance Considerations</h3>
<ol>
<li><strong>Audit Trails</strong>: Ensure message tracking captures redirect activity</li>
<li><strong>Data Retention</strong>: Plan for log retention requirements</li>
<li><strong>Incident Response</strong>: Include redirect logs in security incident procedures</li>
</ol>
<hr />
<h2 id="12-summary-and-lessons-learned">12. Summary and Lessons Learned</h2>
<h3 id="key-takeaways">Key Takeaways</h3>
<ol>
<li><strong>Simple quarantine approaches</strong> can cause significant business disruption</li>
<li><strong>Redirect-based solutions</strong> provide better balance of security and usability  </li>
<li><strong>Layered approach</strong> with multiple rules provides comprehensive protection</li>
<li><strong>ProofPoint bypass attacks</strong> are common and require specific countermeasures</li>
<li><strong>Proper exception handling</strong> is critical for operational success</li>
</ol>
<h3 id="the-final-architecture">The Final Architecture</h3>
<p>Our solution creates a comprehensive security architecture:</p>
<ul>
<li><strong>Layer 1</strong>: ProofPoint SCL rule ensures processed mail is trusted</li>
<li><strong>Layer 2</strong>: Application server exceptions prevent legitimate apps from being redirected</li>
<li><strong>Layer 3</strong>: Bypass redirect ensures all other external mail goes through security stack</li>
<li><strong>Result</strong>: Zero bypass attacks while maintaining business continuity</li>
</ul>
<h3 id="future-considerations">Future Considerations</h3>
<ul>
<li>Monitor for new bypass techniques as attackers evolve</li>
<li>Consider additional security layers as threat landscape changes</li>
<li>Regular review and updates to maintain effectiveness</li>
</ul>
<hr />
<h2 id="13-additional-resources">13. Additional Resources</h2>
<h3 id="useful-powershell-commands">Useful PowerShell Commands</h3>
<div class="highlight"><pre><span></span><code><span class="c"># Connect to Exchange Online</span>
<span class="nb">Connect-ExchangeOnline</span> <span class="n">-UserPrincipalName</span> <span class="n">admin</span><span class="nv">@yourcompany</span><span class="p">.</span><span class="n">com</span>

<span class="c"># List all transport rules with priorities</span>
<span class="nb">Get-TransportRule</span> <span class="p">|</span> <span class="nb">Select-Object</span> <span class="n">Name</span><span class="p">,</span> <span class="n">Priority</span><span class="p">,</span> <span class="n">State</span> <span class="p">|</span> <span class="nb">Sort-Object</span> <span class="n">Priority</span>

<span class="c"># Check specific rule details</span>
<span class="nb">Get-TransportRule</span> <span class="s2">&quot;Redirect Direct Delivery to MX&quot;</span> <span class="p">|</span> <span class="nb">Format-List</span>

<span class="c"># View connector status</span>
<span class="nb">Get-OutboundConnector</span> <span class="s2">&quot;Redirect Bypass to MX&quot;</span> <span class="p">|</span> <span class="nb">Format-List</span>

<span class="c"># Message trace for troubleshooting</span>
<span class="nb">Get-MessageTrace</span> <span class="n">-SenderAddress</span> <span class="s2">&quot;test@externaldomain.com&quot;</span> <span class="n">-StartDate</span> <span class="p">(</span><span class="nb">Get-Date</span><span class="p">).</span><span class="n">AddHours</span><span class="p">(-</span><span class="n">2</span><span class="p">)</span>
</code></pre></div>
<h3 id="dns-verification-commands">DNS Verification Commands</h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Check MX records</span>
dig<span class="w"> </span>+short<span class="w"> </span>MX<span class="w"> </span>yourdomain.com

<span class="c1"># Verify SPF</span>
dig<span class="w"> </span>+short<span class="w"> </span>TXT<span class="w"> </span>yourdomain.com<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>spf

<span class="c1"># Check DMARC policy  </span>
dig<span class="w"> </span>+short<span class="w"> </span>TXT<span class="w"> </span>_dmarc.yourdomain.com

<span class="c1"># Verify DKIM</span>
dig<span class="w"> </span>+short<span class="w"> </span>TXT<span class="w"> </span>selector1._domainkey.yourdomain.com
</code></pre></div>
<hr />
<p><em>This comprehensive approach to email security demonstrates that effective protection requires balancing security needs with operational requirements. The redirect-based solution provides robust protection against bypass attacks while maintaining the business continuity essential for modern organizations.</em></p>
<p><em>For more information, consult Microsoft and Proofpoint documentation, and regularly audit your email security setup. Remember that email security is an ongoing process that requires continuous monitoring and adjustment as threats evolve.</em></p>







  
    
  
  


  <aside class="md-source-file">
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="Last update">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date" title="July 31, 2025 11:45:05 UTC">July 31, 2025</span>
  </span>

    
    
    
    
  </aside>





                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": ["navigation.sections", "content.code.annotate", "content.code.copy"], "search": "../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.13a4f30d.min.js"></script>
      
        <script src="../assets/custom.js"></script>
      
    
  </body>
</html>